{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { handlesGroup as t } from \"../../../../../../core/handleUtils.js\";\nimport has from \"../../../../../../core/has.js\";\nimport { throwIfAborted as e, onAbort as s } from \"../../../../../../core/promiseUtils.js\";\nimport { ATileLoadStrategy as o } from \"./ATileLoadStrategy.js\";\nimport { DrillDownTileSourceChunk as r } from \"./chunks/DrillDownTileSourceChunk.js\";\nimport { FeatureSetReaderJSON as i } from \"../../support/FeatureSetReaderJSON.js\";\nclass l {\n  constructor(e, o) {\n    this.subscription = e, this._tileIdToResult = new Map(), this._controller = new AbortController(), this._handles = t([s(e.signal, () => this._controller.abort()), s(o, () => this._controller.abort())]);\n  }\n  destroy() {\n    this._controller.abort(), this._handles.remove();\n  }\n  get(t) {\n    return this._tileIdToResult.get(t);\n  }\n  set(t, e) {\n    this._tileIdToResult.set(t, e);\n  }\n  get options() {\n    return {\n      signal: this._controller.signal\n    };\n  }\n}\nclass a extends o {\n  constructor() {\n    super(...arguments), this._loadStates = new Map();\n  }\n  destroy() {\n    super.destroy();\n    for (const t of this._loadStates.values()) t.destroy();\n    this._loadStates.clear();\n  }\n  get about() {\n    return {\n      supportsDisplayFilter: !0,\n      willQueryAllFeatures: !1,\n      willQueryFullResolutionGeometry: !1\n    };\n  }\n  async load(t) {\n    this._loadStates.has(t.key.id) || this._loadStates.set(t.key.id, new l(t, this._options));\n    const s = this._loadStates.get(t.key.id);\n    let o;\n    try {\n      for await (const o of this._fetchChunkInfos(s, t.tile, 0)) {\n        const {\n            queryJSON: t,\n            reader: i,\n            sourceTile: l,\n            sourceTileDepth: a,\n            tile: n\n          } = o,\n          h = new r(i, t, n, l, a, !1);\n        e(s.options), this._addChunk(h);\n      }\n    } catch (n) {\n      o = n;\n    }\n    const a = new r(i.empty(this._metadata), null, t.tile, null, -1, !0);\n    if (this._addChunk(a), o) throw o;\n  }\n  unload(t) {\n    super.unload(t), this._loadStates.get(t.key.id)?.destroy(), this._loadStates.delete(t.key.id);\n  }\n  async *_fetchChunkInfos(t, e, s) {\n    let o = t.get(e.id);\n    const r = !!o;\n    if (o || (o = await this._fetchChunkInfo(t, e, s), t.set(e.id, o)), o.reader.exceededTransferLimit && s < has(\"featurelayer-query-max-depth\")) for (const i of e.createChildTiles()) yield* this._fetchChunkInfos(t, i, s + 1);else r || (yield o);\n  }\n  async _fetchChunkInfo(t, e, s) {\n    const o = t.subscription.tile.getQuantizationParameters(),\n      r = this._queryInfo.createTileQuery(e, {\n        returnExceededLimitFeatures: !1,\n        quantizationParameters: o\n      });\n    return {\n      reader: await this._fetch(r, t.options, {\n        chunkId: e.id\n      }),\n      queryJSON: r.inner.toJSON(),\n      tile: t.subscription.tile,\n      sourceTile: e,\n      sourceTileDepth: s\n    };\n  }\n}\nexport { a as DrillDownTileLoadStrategy };","map":{"version":3,"names":["handlesGroup","t","has","throwIfAborted","e","onAbort","s","ATileLoadStrategy","o","DrillDownTileSourceChunk","r","FeatureSetReaderJSON","i","l","constructor","subscription","_tileIdToResult","Map","_controller","AbortController","_handles","signal","abort","destroy","remove","get","set","options","a","arguments","_loadStates","values","clear","about","supportsDisplayFilter","willQueryAllFeatures","willQueryFullResolutionGeometry","load","key","id","_options","_fetchChunkInfos","tile","queryJSON","reader","sourceTile","sourceTileDepth","n","h","_addChunk","empty","_metadata","unload","delete","_fetchChunkInfo","exceededTransferLimit","createChildTiles","getQuantizationParameters","_queryInfo","createTileQuery","returnExceededLimitFeatures","quantizationParameters","_fetch","chunkId","inner","toJSON","DrillDownTileLoadStrategy"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/features/sources/strategies/DrillDownTileLoadStrategy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{handlesGroup as t}from\"../../../../../../core/handleUtils.js\";import has from\"../../../../../../core/has.js\";import{throwIfAborted as e,onAbort as s}from\"../../../../../../core/promiseUtils.js\";import{ATileLoadStrategy as o}from\"./ATileLoadStrategy.js\";import{DrillDownTileSourceChunk as r}from\"./chunks/DrillDownTileSourceChunk.js\";import{FeatureSetReaderJSON as i}from\"../../support/FeatureSetReaderJSON.js\";class l{constructor(e,o){this.subscription=e,this._tileIdToResult=new Map,this._controller=new AbortController,this._handles=t([s(e.signal,(()=>this._controller.abort())),s(o,(()=>this._controller.abort()))])}destroy(){this._controller.abort(),this._handles.remove()}get(t){return this._tileIdToResult.get(t)}set(t,e){this._tileIdToResult.set(t,e)}get options(){return{signal:this._controller.signal}}}class a extends o{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const t of this._loadStates.values())t.destroy();this._loadStates.clear()}get about(){return{supportsDisplayFilter:!0,willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(t){this._loadStates.has(t.key.id)||this._loadStates.set(t.key.id,new l(t,this._options));const s=this._loadStates.get(t.key.id);let o;try{for await(const o of this._fetchChunkInfos(s,t.tile,0)){const{queryJSON:t,reader:i,sourceTile:l,sourceTileDepth:a,tile:n}=o,h=new r(i,t,n,l,a,!1);e(s.options),this._addChunk(h)}}catch(n){o=n}const a=new r(i.empty(this._metadata),null,t.tile,null,-1,!0);if(this._addChunk(a),o)throw o}unload(t){super.unload(t),this._loadStates.get(t.key.id)?.destroy(),this._loadStates.delete(t.key.id)}async*_fetchChunkInfos(t,e,s){let o=t.get(e.id);const r=!!o;if(o||(o=await this._fetchChunkInfo(t,e,s),t.set(e.id,o)),o.reader.exceededTransferLimit&&s<has(\"featurelayer-query-max-depth\"))for(const i of e.createChildTiles())yield*this._fetchChunkInfos(t,i,s+1);else r||(yield o)}async _fetchChunkInfo(t,e,s){const o=t.subscription.tile.getQuantizationParameters(),r=this._queryInfo.createTileQuery(e,{returnExceededLimitFeatures:!1,quantizationParameters:o});return{reader:await this._fetch(r,t.options,{chunkId:e.id}),queryJSON:r.inner.toJSON(),tile:t.subscription.tile,sourceTile:e,sourceTileDepth:s}}}export{a as DrillDownTileLoadStrategy};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}