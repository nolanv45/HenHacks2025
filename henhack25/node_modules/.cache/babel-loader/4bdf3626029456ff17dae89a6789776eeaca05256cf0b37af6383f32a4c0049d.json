{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { sqlAnd as e } from \"../../core/sql.js\";\nimport { getJsonType as t } from \"../../geometry/support/jsonUtils.js\";\nimport { getScale as r } from \"../../geometry/support/scaleUtils.js\";\nimport { srToRESTValue as i } from \"../../geometry/support/spatialReferenceUtils.js\";\nimport { getLayerFloorFilterClause as n } from \"../../layers/support/floorFilterUtils.js\";\nimport { isExportDynamic as s } from \"../../layers/support/sublayerUtils.js\";\nfunction o(e, r) {\n  const {\n      dpi: n,\n      gdbVersion: s,\n      geometry: o,\n      geometryPrecision: a,\n      height: m,\n      historicMoment: p,\n      layerOption: f,\n      mapExtent: y,\n      maxAllowableOffset: u,\n      returnFieldName: c,\n      returnGeometry: d,\n      returnUnformattedValues: g,\n      returnZ: x,\n      spatialReference: h,\n      timeExtent: b,\n      tolerance: E,\n      width: O\n    } = e.toJSON(),\n    {\n      dynamicLayers: S,\n      layerDefs: j,\n      layerIds: N\n    } = l(e),\n    $ = null != r?.geometry ? r.geometry : null,\n    I = {\n      historicMoment: p,\n      geometryPrecision: a,\n      maxAllowableOffset: u,\n      returnFieldName: c,\n      returnGeometry: d,\n      returnUnformattedValues: g,\n      returnZ: x,\n      tolerance: E\n    },\n    R = $?.toJSON() || o;\n  I.imageDisplay = `${O},${m},${n}`, s && (I.gdbVersion = s), R && (delete R.spatialReference, I.geometry = JSON.stringify(R), I.geometryType = t(R));\n  const U = h ?? R?.spatialReference ?? y?.spatialReference;\n  if (U && (I.sr = i(U)), I.time = b ? [b.start, b.end].join(\",\") : null, y) {\n    const {\n      xmin: e,\n      ymin: t,\n      xmax: r,\n      ymax: i\n    } = y;\n    I.mapExtent = `${e},${t},${r},${i}`;\n  }\n  return j && (I.layerDefs = j), S && !j && (I.dynamicLayers = S), I.layers = \"popup\" === f ? \"visible\" : f, N && !S && (I.layers += `:${N.join(\",\")}`), I;\n}\nfunction l(e) {\n  const {\n      mapExtent: t,\n      floors: i,\n      width: o,\n      sublayers: l,\n      layerIds: m,\n      layerOption: p,\n      gdbVersion: f\n    } = e,\n    y = l?.find(e => null != e.layer)?.layer?.serviceSublayers,\n    u = \"popup\" === p,\n    c = {},\n    d = r({\n      extent: t,\n      width: o,\n      spatialReference: t?.spatialReference\n    }),\n    g = [],\n    x = e => {\n      const t = 0 === d,\n        r = 0 === e.minScale || d <= e.minScale,\n        i = 0 === e.maxScale || d >= e.maxScale;\n      if (e.visible && (t || r && i)) if (e.sublayers) e.sublayers.forEach(x);else {\n        if (!1 === m?.includes(e.id) || u && (!e.popupTemplate || !e.popupEnabled)) return;\n        g.unshift(e);\n      }\n    };\n  if (l?.forEach(x), l && !g.length) c.layerIds = [];else {\n    const e = s(g, y, f),\n      t = g.map(e => {\n        const t = n(i, e);\n        return e.toExportImageJSON(t);\n      });\n    if (e) c.dynamicLayers = JSON.stringify(t);else {\n      if (l) {\n        let e = g.map(({\n          id: e\n        }) => e);\n        m && (e = e.filter(e => m.includes(e))), c.layerIds = e;\n      } else m?.length && (c.layerIds = m);\n      const e = a(i, g);\n      if (null != e && e.length) {\n        const t = {};\n        for (const r of e) r.definitionExpression && (t[r.id] = r.definitionExpression);\n        Object.keys(t).length && (c.layerDefs = JSON.stringify(t));\n      }\n    }\n  }\n  return c;\n}\nfunction a(t, r) {\n  const i = !!t?.length,\n    s = r.filter(e => null != e.definitionExpression || i && null != e.floorInfo);\n  return s.length ? s.map(r => {\n    const i = n(t, r),\n      s = e(i, r.definitionExpression);\n    return {\n      id: r.id,\n      definitionExpression: s ?? void 0\n    };\n  }) : null;\n}\nexport { o as identifyToIdentifyRESTParameters, l as toDynamicLayersJSON };","map":{"version":3,"names":["sqlAnd","e","getJsonType","t","getScale","r","srToRESTValue","i","getLayerFloorFilterClause","n","isExportDynamic","s","o","dpi","gdbVersion","geometry","geometryPrecision","a","height","m","historicMoment","p","layerOption","f","mapExtent","y","maxAllowableOffset","u","returnFieldName","c","returnGeometry","d","returnUnformattedValues","g","returnZ","x","spatialReference","h","timeExtent","b","tolerance","E","width","O","toJSON","dynamicLayers","S","layerDefs","j","layerIds","N","l","$","I","R","imageDisplay","JSON","stringify","geometryType","U","sr","time","start","end","join","xmin","ymin","xmax","ymax","layers","floors","sublayers","find","layer","serviceSublayers","extent","minScale","maxScale","visible","forEach","includes","id","popupTemplate","popupEnabled","unshift","length","map","toExportImageJSON","filter","definitionExpression","Object","keys","floorInfo","identifyToIdentifyRESTParameters","toDynamicLayersJSON"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/rest/operations/identify.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{sqlAnd as e}from\"../../core/sql.js\";import{getJsonType as t}from\"../../geometry/support/jsonUtils.js\";import{getScale as r}from\"../../geometry/support/scaleUtils.js\";import{srToRESTValue as i}from\"../../geometry/support/spatialReferenceUtils.js\";import{getLayerFloorFilterClause as n}from\"../../layers/support/floorFilterUtils.js\";import{isExportDynamic as s}from\"../../layers/support/sublayerUtils.js\";function o(e,r){const{dpi:n,gdbVersion:s,geometry:o,geometryPrecision:a,height:m,historicMoment:p,layerOption:f,mapExtent:y,maxAllowableOffset:u,returnFieldName:c,returnGeometry:d,returnUnformattedValues:g,returnZ:x,spatialReference:h,timeExtent:b,tolerance:E,width:O}=e.toJSON(),{dynamicLayers:S,layerDefs:j,layerIds:N}=l(e),$=null!=r?.geometry?r.geometry:null,I={historicMoment:p,geometryPrecision:a,maxAllowableOffset:u,returnFieldName:c,returnGeometry:d,returnUnformattedValues:g,returnZ:x,tolerance:E},R=$?.toJSON()||o;I.imageDisplay=`${O},${m},${n}`,s&&(I.gdbVersion=s),R&&(delete R.spatialReference,I.geometry=JSON.stringify(R),I.geometryType=t(R));const U=h??R?.spatialReference??y?.spatialReference;if(U&&(I.sr=i(U)),I.time=b?[b.start,b.end].join(\",\"):null,y){const{xmin:e,ymin:t,xmax:r,ymax:i}=y;I.mapExtent=`${e},${t},${r},${i}`}return j&&(I.layerDefs=j),S&&!j&&(I.dynamicLayers=S),I.layers=\"popup\"===f?\"visible\":f,N&&!S&&(I.layers+=`:${N.join(\",\")}`),I}function l(e){const{mapExtent:t,floors:i,width:o,sublayers:l,layerIds:m,layerOption:p,gdbVersion:f}=e,y=l?.find((e=>null!=e.layer))?.layer?.serviceSublayers,u=\"popup\"===p,c={},d=r({extent:t,width:o,spatialReference:t?.spatialReference}),g=[],x=e=>{const t=0===d,r=0===e.minScale||d<=e.minScale,i=0===e.maxScale||d>=e.maxScale;if(e.visible&&(t||r&&i))if(e.sublayers)e.sublayers.forEach(x);else{if(!1===m?.includes(e.id)||u&&(!e.popupTemplate||!e.popupEnabled))return;g.unshift(e)}};if(l?.forEach(x),l&&!g.length)c.layerIds=[];else{const e=s(g,y,f),t=g.map((e=>{const t=n(i,e);return e.toExportImageJSON(t)}));if(e)c.dynamicLayers=JSON.stringify(t);else{if(l){let e=g.map((({id:e})=>e));m&&(e=e.filter((e=>m.includes(e)))),c.layerIds=e}else m?.length&&(c.layerIds=m);const e=a(i,g);if(null!=e&&e.length){const t={};for(const r of e)r.definitionExpression&&(t[r.id]=r.definitionExpression);Object.keys(t).length&&(c.layerDefs=JSON.stringify(t))}}}return c}function a(t,r){const i=!!t?.length,s=r.filter((e=>null!=e.definitionExpression||i&&null!=e.floorInfo));return s.length?s.map((r=>{const i=n(t,r),s=e(i,r.definitionExpression);return{id:r.id,definitionExpression:s??void 0}})):null}export{o as identifyToIdentifyRESTParameters,l as toDynamicLayersJSON};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}