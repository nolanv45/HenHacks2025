{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport s from \"../../../core/Error.js\";\nimport has from \"../../../core/has.js\";\nimport { eachAlways as e, createAbortError as r } from \"../../../core/promiseUtils.js\";\nimport { property as a } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/Logger.js\";\nimport \"../../../core/RandomLCG.js\";\nimport { subclass as o } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport i from \"../../../geometry/Extent.js\";\nimport n from \"../../../geometry/SpatialReference.js\";\nimport l from \"./BaseRaster.js\";\nimport m from \"./InMemoryRaster.js\";\nimport { parsePAMInfo as p } from \"./pamParser.js\";\nimport { getFormat as c } from \"../rasterFormats/RasterCodec.js\";\nimport { estimateStatisticsFromHistograms as f } from \"../rasterFunctions/stretchUtils.js\";\nimport u from \"../rasterTransforms/PolynomialTransform.js\";\nlet h = class extends l {\n  fetchRawTile(t, s, e, r = {}) {\n    return this._inMemoryRaster.fetchRawTile(t, s, e, r);\n  }\n  async _open(t) {\n    const s = await this._fetchData(t);\n    let {\n      spatialReference: e,\n      statistics: r,\n      histograms: a,\n      transform: o\n    } = await this._fetchAuxiliaryData(t);\n    const l = !e;\n    l && (e = new n({\n      wkid: 3857\n    })), a?.length && null == r && (r = f(a));\n    const {\n      width: p,\n      height: c\n    } = s;\n    let u = new i({\n      xmin: -.5,\n      ymin: .5 - c,\n      xmax: p - .5,\n      ymax: .5,\n      spatialReference: e\n    });\n    const h = o ? o.forwardTransform(u) : u;\n    let d = !0;\n    if (o) {\n      const t = o.forwardCoefficients;\n      d = t && 0 === t[1] && 0 === t[2], d && (o = null, u = h);\n    }\n    const w = new m({\n      source: {\n        extent: h,\n        nativeExtent: u,\n        transform: o,\n        pixelBlocks: [s],\n        statistics: r,\n        histograms: a,\n        keyProperties: {\n          DateType: \"Processed\"\n        },\n        isPseudoSpatialReference: l\n      },\n      ioConfig: {\n        sampling: \"closest\",\n        skipStatistics: !0\n      }\n    });\n    this.ioConfig.skipMapInfo && (w.ioConfig.skipMapInfo = !0), await w.open(), w.source = null, this._set(\"rasterInfo\", w.rasterInfo), this._inMemoryRaster = w;\n  }\n  async _fetchData(t) {\n    const {\n        data: e\n      } = await this.request(this.url, {\n        responseType: \"array-buffer\",\n        signal: t?.signal\n      }),\n      r = c(e).toUpperCase();\n    if (\"JPG\" !== r && \"PNG\" !== r && \"GIF\" !== r && \"BMP\" !== r) throw new s(\"image-aux-raster:open\", \"the data is not a supported format\");\n    this._set(\"datasetFormat\", r);\n    const a = r.toLowerCase(),\n      o = \"gif\" === a || \"bmp\" === a || !has(\"ios\"),\n      i = await this.decodePixelBlock(e, {\n        format: a,\n        useCanvas: o,\n        hasNoZlibMask: !0\n      });\n    if (null == i) throw new s(\"image-aux-raster:open\", \"the data cannot be decoded\");\n    return i;\n  }\n  async _fetchAuxiliaryData(t) {\n    const s = t?.signal,\n      {\n        skipExtensions: a = [],\n        skipMapInfo: o\n      } = this.ioConfig,\n      i = o || a.includes(\"aux.xml\") ? null : this.request(this.url + \".aux.xml\", {\n        responseType: \"xml\",\n        signal: s\n      }),\n      n = this.datasetFormat,\n      l = \"JPG\" === n ? \"jgw\" : \"PNG\" === n ? \"pgw\" : \"BMP\" === n ? \"bpw\" : null,\n      m = l && a.includes(l) ? null : this.request(this.url.slice(0, this.url.lastIndexOf(\".\")) + \".\" + l, {\n        responseType: \"text\",\n        signal: s\n      }),\n      c = await e([i, m]);\n    if (s?.aborted) throw r();\n    const f = p(c[0].value?.data);\n    if (!f.transform) {\n      const t = c[1].value ? c[1].value.data.split(\"\\n\").slice(0, 6).map(t => Number(t)) : null;\n      f.transform = 6 === t?.length ? new u({\n        forwardCoefficients: [t[4], t[5], t[0], -t[1], t[2], -t[3]]\n      }) : null;\n    }\n    return f;\n  }\n};\nt([a({\n  type: String,\n  json: {\n    write: !0\n  }\n})], h.prototype, \"datasetFormat\", void 0), h = t([o(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")], h);\nconst d = h;\nexport { d as default };","map":{"version":3,"names":["_","t","s","has","eachAlways","e","createAbortError","r","property","a","subclass","o","i","n","l","m","parsePAMInfo","p","getFormat","c","estimateStatisticsFromHistograms","f","u","h","fetchRawTile","_inMemoryRaster","_open","_fetchData","spatialReference","statistics","histograms","transform","_fetchAuxiliaryData","wkid","length","width","height","xmin","ymin","xmax","ymax","forwardTransform","d","forwardCoefficients","w","source","extent","nativeExtent","pixelBlocks","keyProperties","DateType","isPseudoSpatialReference","ioConfig","sampling","skipStatistics","skipMapInfo","open","_set","rasterInfo","data","request","url","responseType","signal","toUpperCase","toLowerCase","decodePixelBlock","format","useCanvas","hasNoZlibMask","skipExtensions","includes","datasetFormat","slice","lastIndexOf","aborted","value","split","map","Number","type","String","json","write","prototype","default"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/layers/support/rasterDatasets/ImageAuxRaster.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import s from\"../../../core/Error.js\";import has from\"../../../core/has.js\";import{eachAlways as e,createAbortError as r}from\"../../../core/promiseUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/Logger.js\";import\"../../../core/RandomLCG.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import i from\"../../../geometry/Extent.js\";import n from\"../../../geometry/SpatialReference.js\";import l from\"./BaseRaster.js\";import m from\"./InMemoryRaster.js\";import{parsePAMInfo as p}from\"./pamParser.js\";import{getFormat as c}from\"../rasterFormats/RasterCodec.js\";import{estimateStatisticsFromHistograms as f}from\"../rasterFunctions/stretchUtils.js\";import u from\"../rasterTransforms/PolynomialTransform.js\";let h=class extends l{fetchRawTile(t,s,e,r={}){return this._inMemoryRaster.fetchRawTile(t,s,e,r)}async _open(t){const s=await this._fetchData(t);let{spatialReference:e,statistics:r,histograms:a,transform:o}=await this._fetchAuxiliaryData(t);const l=!e;l&&(e=new n({wkid:3857})),a?.length&&null==r&&(r=f(a));const{width:p,height:c}=s;let u=new i({xmin:-.5,ymin:.5-c,xmax:p-.5,ymax:.5,spatialReference:e});const h=o?o.forwardTransform(u):u;let d=!0;if(o){const t=o.forwardCoefficients;d=t&&0===t[1]&&0===t[2],d&&(o=null,u=h)}const w=new m({source:{extent:h,nativeExtent:u,transform:o,pixelBlocks:[s],statistics:r,histograms:a,keyProperties:{DateType:\"Processed\"},isPseudoSpatialReference:l},ioConfig:{sampling:\"closest\",skipStatistics:!0}});this.ioConfig.skipMapInfo&&(w.ioConfig.skipMapInfo=!0),await w.open(),w.source=null,this._set(\"rasterInfo\",w.rasterInfo),this._inMemoryRaster=w}async _fetchData(t){const{data:e}=await this.request(this.url,{responseType:\"array-buffer\",signal:t?.signal}),r=c(e).toUpperCase();if(\"JPG\"!==r&&\"PNG\"!==r&&\"GIF\"!==r&&\"BMP\"!==r)throw new s(\"image-aux-raster:open\",\"the data is not a supported format\");this._set(\"datasetFormat\",r);const a=r.toLowerCase(),o=\"gif\"===a||\"bmp\"===a||!has(\"ios\"),i=await this.decodePixelBlock(e,{format:a,useCanvas:o,hasNoZlibMask:!0});if(null==i)throw new s(\"image-aux-raster:open\",\"the data cannot be decoded\");return i}async _fetchAuxiliaryData(t){const s=t?.signal,{skipExtensions:a=[],skipMapInfo:o}=this.ioConfig,i=o||a.includes(\"aux.xml\")?null:this.request(this.url+\".aux.xml\",{responseType:\"xml\",signal:s}),n=this.datasetFormat,l=\"JPG\"===n?\"jgw\":\"PNG\"===n?\"pgw\":\"BMP\"===n?\"bpw\":null,m=l&&a.includes(l)?null:this.request(this.url.slice(0,this.url.lastIndexOf(\".\"))+\".\"+l,{responseType:\"text\",signal:s}),c=await e([i,m]);if(s?.aborted)throw r();const f=p(c[0].value?.data);if(!f.transform){const t=c[1].value?c[1].value.data.split(\"\\n\").slice(0,6).map((t=>Number(t))):null;f.transform=6===t?.length?new u({forwardCoefficients:[t[4],t[5],t[0],-t[1],t[2],-t[3]]}):null}return f}};t([a({type:String,json:{write:!0}})],h.prototype,\"datasetFormat\",void 0),h=t([o(\"esri.layers.support.rasterDatasets.ImageAuxRaster\")],h);const d=h;export{d as default};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}