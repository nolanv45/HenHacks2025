{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport has from \"../../../../../../../core/has.js\";\nimport t from \"../../../../../../../core/workers/Connection.js\";\nimport { toQuantizationTransform as e } from \"../../../../../../../geometry/support/quantizationUtils.js\";\nimport { convertFromFeatureSet as r, quantizeOptimizedFeatureSet as a } from \"../../../../../../../layers/graphics/featureConversionUtils.js\";\nimport { queryOptimizedFeatureSet as s } from \"../../../../../../../layers/ogc/ogcFeatureUtils.js\";\nimport { executeQueryPBFBuffer as i, executeQuery as o } from \"../../../../../../../rest/query/operations/query.js\";\nimport { FeatureSetReaderJSON as n } from \"../../../support/FeatureSetReaderJSON.js\";\nimport { FeatureSetReaderPBF as u } from \"../../../support/FeatureSetReaderPBF.js\";\nclass c {\n  constructor(t, e) {\n    this.service = t, this._metadata = e;\n  }\n  destroy() {}\n}\nfunction m(t, e) {\n  switch (t.type) {\n    case \"memory\":\n      return new l(t, e);\n    case \"ogc\":\n      return new y(t, e);\n    case \"feature-service\":\n      return t.queryMetadata.supportsFormatPBF && has(\"featurelayer-pbf\") ? new d(t, e) : new f(t, e);\n  }\n}\nasync function p(e) {\n  const r = new t();\n  return await r.open(e, {}), r;\n}\nclass l extends c {\n  constructor(t, e) {\n    super(t, e), this._portsOpen = p(t.source).then(t => this.client = t);\n  }\n  destroy() {\n    this.client.close(), this.client = null;\n  }\n  async executeQuery(t, e) {\n    await this._portsOpen;\n    const r = await this.client.invoke(\"queryFeatures\", t.toJSON(), e);\n    return n.fromFeatureSet(r, this._metadata);\n  }\n}\nclass d extends c {\n  async executeQuery(t, e) {\n    const {\n        data: r\n      } = await i(this.service.source, t, e),\n      a = !t.quantizationParameters;\n    return u.fromBuffer(r, this._metadata, a);\n  }\n}\nclass f extends c {\n  async executeQuery(t, s) {\n    const {\n      source: i,\n      queryMetadata: u\n    } = this.service;\n    if (null != t.quantizationParameters && !u.supportsQuantization) {\n      const u = t.clone(),\n        c = e(u.quantizationParameters);\n      u.quantizationParameters = null;\n      const {\n          data: m\n        } = await o(i, u, this._metadata.spatialReference, s),\n        p = r(m, this._metadata.objectIdField);\n      return a(c, p), n.fromOptimizedFeatureSet(p, this._metadata);\n    }\n    const {\n      data: c\n    } = await o(i, t, this._metadata.spatialReference, s);\n    return \"esriGeometryPoint\" === this._metadata.geometryType && (c.features = c.features?.filter(t => {\n      if (null != t.geometry) {\n        const e = t.geometry;\n        return Number.isFinite(e.x) && Number.isFinite(e.y);\n      }\n      return !0;\n    })), n.fromFeatureSet(c, this._metadata);\n  }\n}\nclass y extends c {\n  async executeQuery(t, r) {\n    if (t.quantizationParameters && !this.service.queryMetadata.supportsQuantization) {\n      const i = t.clone(),\n        o = e(i.quantizationParameters);\n      i.quantizationParameters = null;\n      const u = await s(this.service.source, t, r);\n      return a(o, u), n.fromOptimizedFeatureSet(u, this._metadata);\n    }\n    const i = await s(this.service.source, t, r);\n    return n.fromOptimizedFeatureSet(i, this._metadata);\n  }\n}\nexport { c as SourceAdapter, m as createQueryAdapter };","map":{"version":3,"names":["has","t","toQuantizationTransform","e","convertFromFeatureSet","r","quantizeOptimizedFeatureSet","a","queryOptimizedFeatureSet","s","executeQueryPBFBuffer","i","executeQuery","o","FeatureSetReaderJSON","n","FeatureSetReaderPBF","u","c","constructor","service","_metadata","destroy","m","type","l","y","queryMetadata","supportsFormatPBF","d","f","p","open","_portsOpen","source","then","client","close","invoke","toJSON","fromFeatureSet","data","quantizationParameters","fromBuffer","supportsQuantization","clone","spatialReference","objectIdField","fromOptimizedFeatureSet","geometryType","features","filter","geometry","Number","isFinite","x","SourceAdapter","createQueryAdapter"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/features/sources/strategies/support/queryAdapters.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport has from\"../../../../../../../core/has.js\";import t from\"../../../../../../../core/workers/Connection.js\";import{toQuantizationTransform as e}from\"../../../../../../../geometry/support/quantizationUtils.js\";import{convertFromFeatureSet as r,quantizeOptimizedFeatureSet as a}from\"../../../../../../../layers/graphics/featureConversionUtils.js\";import{queryOptimizedFeatureSet as s}from\"../../../../../../../layers/ogc/ogcFeatureUtils.js\";import{executeQueryPBFBuffer as i,executeQuery as o}from\"../../../../../../../rest/query/operations/query.js\";import{FeatureSetReaderJSON as n}from\"../../../support/FeatureSetReaderJSON.js\";import{FeatureSetReaderPBF as u}from\"../../../support/FeatureSetReaderPBF.js\";class c{constructor(t,e){this.service=t,this._metadata=e}destroy(){}}function m(t,e){switch(t.type){case\"memory\":return new l(t,e);case\"ogc\":return new y(t,e);case\"feature-service\":return t.queryMetadata.supportsFormatPBF&&has(\"featurelayer-pbf\")?new d(t,e):new f(t,e)}}async function p(e){const r=new t;return await r.open(e,{}),r}class l extends c{constructor(t,e){super(t,e),this._portsOpen=p(t.source).then((t=>this.client=t))}destroy(){this.client.close(),this.client=null}async executeQuery(t,e){await this._portsOpen;const r=await this.client.invoke(\"queryFeatures\",t.toJSON(),e);return n.fromFeatureSet(r,this._metadata)}}class d extends c{async executeQuery(t,e){const{data:r}=await i(this.service.source,t,e),a=!t.quantizationParameters;return u.fromBuffer(r,this._metadata,a)}}class f extends c{async executeQuery(t,s){const{source:i,queryMetadata:u}=this.service;if(null!=t.quantizationParameters&&!u.supportsQuantization){const u=t.clone(),c=e(u.quantizationParameters);u.quantizationParameters=null;const{data:m}=await o(i,u,this._metadata.spatialReference,s),p=r(m,this._metadata.objectIdField);return a(c,p),n.fromOptimizedFeatureSet(p,this._metadata)}const{data:c}=await o(i,t,this._metadata.spatialReference,s);return\"esriGeometryPoint\"===this._metadata.geometryType&&(c.features=c.features?.filter((t=>{if(null!=t.geometry){const e=t.geometry;return Number.isFinite(e.x)&&Number.isFinite(e.y)}return!0}))),n.fromFeatureSet(c,this._metadata)}}class y extends c{async executeQuery(t,r){if(t.quantizationParameters&&!this.service.queryMetadata.supportsQuantization){const i=t.clone(),o=e(i.quantizationParameters);i.quantizationParameters=null;const u=await s(this.service.source,t,r);return a(o,u),n.fromOptimizedFeatureSet(u,this._metadata)}const i=await s(this.service.source,t,r);return n.fromOptimizedFeatureSet(i,this._metadata)}}export{c as SourceAdapter,m as createQueryAdapter};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}