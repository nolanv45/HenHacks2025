{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/Error.js\";\nimport t from \"../../../../../../core/Logger.js\";\nimport { QueueProcessor as r } from \"../../../../../../core/QueueProcessor.js\";\nimport s from \"../../../../../../rest/support/Query.js\";\nimport { ALoadStrategy as n } from \"./ALoadStrategy.js\";\nimport { createQueryAdapter as o } from \"./support/queryAdapters.js\";\nimport { FeatureSetReaderJSON as u } from \"../../support/FeatureSetReaderJSON.js\";\nclass i extends n {\n  constructor(e, t, s, n, u) {\n    super(s), this._serviceInfo = e, this._queryInfo = t, this._metadata = n, this._connection = u, this._queue = new r({\n      concurrency: 32,\n      process: async e => {\n        const t = {\n          signal: e.options?.signal,\n          query: e.query.customParameters,\n          useRequestQueue: !0\n        };\n        return this._adapter.executeQuery(e.query.inner, t);\n      }\n    }), this._adapter = o(e, n);\n  }\n  unsafeSetQueryHistoricMoment(e) {\n    this._queryInfo.updateHistoricMoment(e);\n  }\n  async updateFields(t) {\n    this._queryInfo.updateFields(t);\n    const r = Array.from(this._store.chunks()).map(async e => {\n        const t = s.fromJSON(e.queryInfo.queryJSON);\n        if (t) try {\n          return await this._tryUpdateFields(e.reader, t, {\n            chunkId: e.chunkId\n          }), null;\n        } catch (r) {\n          return r;\n        }\n      }),\n      n = (await Promise.all(r)).filter(e => e);\n    if (n.length) throw new e(\"featurelayer-query\", \"Encountered errors when downloading fields\", {\n      errors: n\n    });\n  }\n  async queryByObjectId(e) {\n    if (0 === e.length) return u.empty(this._metadata);\n    const t = this._queryInfo.createQuery({\n      objectIds: e\n    });\n    return this._fetch(t, null, null);\n  }\n  async _fetch(e, t, r) {\n    const s = await this._enqueue(e, t);\n    return await this._tryUpdateFields(s, e.inner, r), s;\n  }\n  async _tryUpdateFields(r, s, n) {\n    const o = this._queryInfo.createPatchFieldsQuery(s, r, n);\n    if (!o) return;\n    const u = await this._enqueue(o, this._options);\n    u.getSize() === r.getSize() ? r.joinAttributes(u) : t.getLogger(\"esri.views.2d.layers.features.sources.strategies.AFetchLoadStrategy\").error(new e(\"featurelayer-query\", `Failed to join features. Expected a count of ${r.getSize()} features, but got ${u.getSize()}`, {\n      query: o.inner.toJSON(),\n      debugInfo: n\n    }));\n  }\n  async _enqueue(e, t) {\n    return this._connection.onEvent({\n      type: \"fetchStart\"\n    }), this._queue.push({\n      query: e,\n      options: t\n    }).finally(() => {\n      this._connection.onEvent({\n        type: \"fetchEnd\",\n        done: 0 === this._queue.length\n      });\n    });\n  }\n}\nexport { i as AFetchLoadStrategy };","map":{"version":3,"names":["e","t","QueueProcessor","r","s","ALoadStrategy","n","createQueryAdapter","o","FeatureSetReaderJSON","u","i","constructor","_serviceInfo","_queryInfo","_metadata","_connection","_queue","concurrency","process","signal","options","query","customParameters","useRequestQueue","_adapter","executeQuery","inner","unsafeSetQueryHistoricMoment","updateHistoricMoment","updateFields","Array","from","_store","chunks","map","fromJSON","queryInfo","queryJSON","_tryUpdateFields","reader","chunkId","Promise","all","filter","length","errors","queryByObjectId","empty","createQuery","objectIds","_fetch","_enqueue","createPatchFieldsQuery","_options","getSize","joinAttributes","getLogger","error","toJSON","debugInfo","onEvent","type","push","finally","done","AFetchLoadStrategy"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/features/sources/strategies/AFetchLoadStrategy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/Error.js\";import t from\"../../../../../../core/Logger.js\";import{QueueProcessor as r}from\"../../../../../../core/QueueProcessor.js\";import s from\"../../../../../../rest/support/Query.js\";import{ALoadStrategy as n}from\"./ALoadStrategy.js\";import{createQueryAdapter as o}from\"./support/queryAdapters.js\";import{FeatureSetReaderJSON as u}from\"../../support/FeatureSetReaderJSON.js\";class i extends n{constructor(e,t,s,n,u){super(s),this._serviceInfo=e,this._queryInfo=t,this._metadata=n,this._connection=u,this._queue=new r({concurrency:32,process:async e=>{const t={signal:e.options?.signal,query:e.query.customParameters,useRequestQueue:!0};return this._adapter.executeQuery(e.query.inner,t)}}),this._adapter=o(e,n)}unsafeSetQueryHistoricMoment(e){this._queryInfo.updateHistoricMoment(e)}async updateFields(t){this._queryInfo.updateFields(t);const r=Array.from(this._store.chunks()).map((async e=>{const t=s.fromJSON(e.queryInfo.queryJSON);if(t)try{return await this._tryUpdateFields(e.reader,t,{chunkId:e.chunkId}),null}catch(r){return r}})),n=(await Promise.all(r)).filter((e=>e));if(n.length)throw new e(\"featurelayer-query\",\"Encountered errors when downloading fields\",{errors:n})}async queryByObjectId(e){if(0===e.length)return u.empty(this._metadata);const t=this._queryInfo.createQuery({objectIds:e});return this._fetch(t,null,null)}async _fetch(e,t,r){const s=await this._enqueue(e,t);return await this._tryUpdateFields(s,e.inner,r),s}async _tryUpdateFields(r,s,n){const o=this._queryInfo.createPatchFieldsQuery(s,r,n);if(!o)return;const u=await this._enqueue(o,this._options);u.getSize()===r.getSize()?r.joinAttributes(u):t.getLogger(\"esri.views.2d.layers.features.sources.strategies.AFetchLoadStrategy\").error(new e(\"featurelayer-query\",`Failed to join features. Expected a count of ${r.getSize()} features, but got ${u.getSize()}`,{query:o.inner.toJSON(),debugInfo:n}))}async _enqueue(e,t){return this._connection.onEvent({type:\"fetchStart\"}),this._queue.push({query:e,options:t}).finally((()=>{this._connection.onEvent({type:\"fetchEnd\",done:0===this._queue.length})}))}}export{i as AFetchLoadStrategy};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}