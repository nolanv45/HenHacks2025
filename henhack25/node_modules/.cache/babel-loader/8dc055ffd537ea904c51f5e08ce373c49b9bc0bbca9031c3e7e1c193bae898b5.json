{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../../chunks/tslib.es6.js\";\nimport has from \"../../../../../../core/has.js\";\nimport { throwIfAborted as r } from \"../../../../../../core/promiseUtils.js\";\nimport \"../../../../../../core/Logger.js\";\nimport \"../../../../../../core/RandomLCG.js\";\nimport \"../../../../../../core/Error.js\";\nimport { subclass as s } from \"../../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { VertexAttribute as o } from \"../../../../webgl-engine/lib/VertexAttribute.js\";\nimport { LodRenderer as n } from \"../../../../webgl-engine/lib/lodRendering/LodRenderer.js\";\nimport { LodComponentRenderGeometry as t, LodComponentResources as i, LodLevelResources as a, LodResources as d } from \"../../../../webgl-engine/lib/lodRendering/LodResources.js\";\nlet l = class {\n  constructor(e) {\n    this._optionalFields = new Array(), this._featureIdToInstanceIndex = new Map(), this._disposeResourceHandles = new Array(), this._lodRendererResources = null, this.layerUid = e.layerUid, this.view = e.view, this.sharedResources = this.view.sharedSymbolResources, this.scheduler = this.view.resourceController.scheduler;\n  }\n  get numFeatures() {\n    return this._featureIdToInstanceIndex.size;\n  }\n  get usedMemory() {\n    const e = this._lodRendererResources?.lodRenderer,\n      r = e?.symbol;\n    return (r?.computeUsedMemory() ?? 0) + 16 * this._featureIdToInstanceIndex.size;\n  }\n  destroy() {\n    this._disposeResourceHandles.forEach(e => e());\n  }\n  async doLoad(e, s, n) {\n    has(\"enable-feature:objectAndLayerId-rendering\") && this._optionalFields.push(o.OBJECTANDLAYERIDCOLOR);\n    const t = c(e => s(e), e),\n      i = this.view._stage,\n      a = t.getMaterials();\n    i.addMany(a), this._addDisposeResource(() => i.removeMany(a));\n    const d = t.getTextures();\n    i.addMany(d), this._addDisposeResource(() => {\n      d.forEach(e => e.unload()), i.removeMany(d);\n    }), await Promise.all(d.map(e => this.view._stage.schedule(() => e.load(i.renderView.renderingContext), n))), r(n);\n    const l = await this._createLodRenderer(t, n);\n    this._lodRendererResources = {\n      lodRenderer: l,\n      materials: a,\n      textures: d\n    };\n  }\n  addInstances(e) {\n    const r = this._lodRendererResources;\n    if (null == r) return;\n    const {\n        featureIds: s,\n        localTransforms: o,\n        globalTransforms: n\n      } = e,\n      t = r.lodRenderer;\n    if (null == t) return;\n    const i = t.instanceData,\n      a = s.length;\n    for (let d = 0; d < a; ++d) {\n      const e = s[d],\n        r = i.addInstance(),\n        t = i.view,\n        a = 16 * d;\n      t.localTransform.copyFromTypedBuffer(r, o, a), t.globalTransform.copyFromTypedBuffer(r, n, a), i.updateModelTransform(r), i.setVisible(r, !0), this._featureIdToInstanceIndex.set(e, r);\n    }\n  }\n  removeInstances(e) {\n    const r = this._lodRendererResources;\n    if (null == r) return;\n    const s = r.lodRenderer.instanceData,\n      o = this._featureIdToInstanceIndex,\n      n = e.length;\n    for (let t = 0; t < n; ++t) {\n      const r = e[t],\n        n = o.get(r);\n      null != n && (s.removeInstance(n), o.delete(r));\n    }\n  }\n  _addDisposeResource(e) {\n    this._disposeResourceHandles.push(e);\n  }\n  async _createLodRenderer(e, r) {\n    const s = this.view._stage,\n      o = {\n        layerUid: this.layerUid,\n        graphicUid: e => 1,\n        notifyGraphicGeometryChanged: e => 1,\n        notifyGraphicVisibilityChanged: e => 1\n      },\n      t = new n({\n        symbol: e,\n        optionalFields: this._optionalFields,\n        metadata: o,\n        shaderTransformation: null\n      }, this.scheduler);\n    return t.slicePlaneEnabled = !1, this._addDisposeResource(() => {\n      s.removeRenderPlugin(t), t.destroy();\n    }), await s.addRenderPlugin(t, r), t;\n  }\n};\nfunction c(e, r) {\n  const s = r.levels.map(r => {\n    const s = r.components.map(r => {\n      const s = e(r.materialId);\n      if (!u(s)) throw new Error(\"LodRenderer only supports DefaultMaterial\");\n      const o = new t(s, r.renderGeometryBuffer.data, r.renderGeometryBuffer.elementCount, r.boundingInfo);\n      return new i(o);\n    });\n    return new a(s, r.minScreenSpaceRadius);\n  });\n  return new d(s);\n}\nfunction u(e) {\n  return null != e && \"materialType\" in e && \"default\" === e.materialType;\n}\nl = e([s(\"esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer\")], l);\nexport { l as LodRenderer, u as isDefaultMaterial };","map":{"version":3,"names":["_","e","has","throwIfAborted","r","subclass","s","VertexAttribute","o","LodRenderer","n","LodComponentRenderGeometry","t","LodComponentResources","i","LodLevelResources","a","LodResources","d","l","constructor","_optionalFields","Array","_featureIdToInstanceIndex","Map","_disposeResourceHandles","_lodRendererResources","layerUid","view","sharedResources","sharedSymbolResources","scheduler","resourceController","numFeatures","size","usedMemory","lodRenderer","symbol","computeUsedMemory","destroy","forEach","doLoad","push","OBJECTANDLAYERIDCOLOR","c","_stage","getMaterials","addMany","_addDisposeResource","removeMany","getTextures","unload","Promise","all","map","schedule","load","renderView","renderingContext","_createLodRenderer","materials","textures","addInstances","featureIds","localTransforms","globalTransforms","instanceData","length","addInstance","localTransform","copyFromTypedBuffer","globalTransform","updateModelTransform","setVisible","set","removeInstances","get","removeInstance","delete","graphicUid","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","optionalFields","metadata","shaderTransformation","slicePlaneEnabled","removeRenderPlugin","addRenderPlugin","levels","components","materialId","u","Error","renderGeometryBuffer","data","elementCount","boundingInfo","minScreenSpaceRadius","materialType","isDefaultMaterial"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/3d/layers/graphics/pipeline/rendering/LodRenderer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../../chunks/tslib.es6.js\";import has from\"../../../../../../core/has.js\";import{throwIfAborted as r}from\"../../../../../../core/promiseUtils.js\";import\"../../../../../../core/Logger.js\";import\"../../../../../../core/RandomLCG.js\";import\"../../../../../../core/Error.js\";import{subclass as s}from\"../../../../../../core/accessorSupport/decorators/subclass.js\";import{VertexAttribute as o}from\"../../../../webgl-engine/lib/VertexAttribute.js\";import{LodRenderer as n}from\"../../../../webgl-engine/lib/lodRendering/LodRenderer.js\";import{LodComponentRenderGeometry as t,LodComponentResources as i,LodLevelResources as a,LodResources as d}from\"../../../../webgl-engine/lib/lodRendering/LodResources.js\";let l=class{constructor(e){this._optionalFields=new Array,this._featureIdToInstanceIndex=new Map,this._disposeResourceHandles=new Array,this._lodRendererResources=null,this.layerUid=e.layerUid,this.view=e.view,this.sharedResources=this.view.sharedSymbolResources,this.scheduler=this.view.resourceController.scheduler}get numFeatures(){return this._featureIdToInstanceIndex.size}get usedMemory(){const e=this._lodRendererResources?.lodRenderer,r=e?.symbol;return(r?.computeUsedMemory()??0)+16*this._featureIdToInstanceIndex.size}destroy(){this._disposeResourceHandles.forEach((e=>e()))}async doLoad(e,s,n){has(\"enable-feature:objectAndLayerId-rendering\")&&this._optionalFields.push(o.OBJECTANDLAYERIDCOLOR);const t=c((e=>s(e)),e),i=this.view._stage,a=t.getMaterials();i.addMany(a),this._addDisposeResource((()=>i.removeMany(a)));const d=t.getTextures();i.addMany(d),this._addDisposeResource((()=>{d.forEach((e=>e.unload())),i.removeMany(d)})),await Promise.all(d.map((e=>this.view._stage.schedule((()=>e.load(i.renderView.renderingContext)),n)))),r(n);const l=await this._createLodRenderer(t,n);this._lodRendererResources={lodRenderer:l,materials:a,textures:d}}addInstances(e){const r=this._lodRendererResources;if(null==r)return;const{featureIds:s,localTransforms:o,globalTransforms:n}=e,t=r.lodRenderer;if(null==t)return;const i=t.instanceData,a=s.length;for(let d=0;d<a;++d){const e=s[d],r=i.addInstance(),t=i.view,a=16*d;t.localTransform.copyFromTypedBuffer(r,o,a),t.globalTransform.copyFromTypedBuffer(r,n,a),i.updateModelTransform(r),i.setVisible(r,!0),this._featureIdToInstanceIndex.set(e,r)}}removeInstances(e){const r=this._lodRendererResources;if(null==r)return;const s=r.lodRenderer.instanceData,o=this._featureIdToInstanceIndex,n=e.length;for(let t=0;t<n;++t){const r=e[t],n=o.get(r);null!=n&&(s.removeInstance(n),o.delete(r))}}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createLodRenderer(e,r){const s=this.view._stage,o={layerUid:this.layerUid,graphicUid:e=>1,notifyGraphicGeometryChanged:e=>1,notifyGraphicVisibilityChanged:e=>1},t=new n({symbol:e,optionalFields:this._optionalFields,metadata:o,shaderTransformation:null},this.scheduler);return t.slicePlaneEnabled=!1,this._addDisposeResource((()=>{s.removeRenderPlugin(t),t.destroy()})),await s.addRenderPlugin(t,r),t}};function c(e,r){const s=r.levels.map((r=>{const s=r.components.map((r=>{const s=e(r.materialId);if(!u(s))throw new Error(\"LodRenderer only supports DefaultMaterial\");const o=new t(s,r.renderGeometryBuffer.data,r.renderGeometryBuffer.elementCount,r.boundingInfo);return new i(o)}));return new a(s,r.minScreenSpaceRadius)}));return new d(s)}function u(e){return null!=e&&\"materialType\"in e&&\"default\"===e.materialType}l=e([s(\"esri.views.3d.layers.graphics.pipeline.rendering.LodRenderer\")],l);export{l as LodRenderer,u as isDefaultMaterial};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}