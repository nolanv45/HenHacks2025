{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Error.js\";\nimport e from \"../../../../../core/Logger.js\";\nimport { create as i } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsXY as s } from \"../../../../../geometry/support/boundsUtils.js\";\nimport { normalizeQueryLike as r } from \"../../../../../layers/graphics/data/queryUtils.js\";\nimport { getSpatialQueryOperator as o } from \"../../../../../layers/graphics/data/spatialQuerySupport.js\";\nimport { getTimeOperator as a } from \"../../../../../layers/graphics/data/timeSupport.js\";\nimport h from \"../../../../../rest/support/Query.js\";\nimport { FeatureStoreQueryAdapter as l } from \"../FeatureStoreQueryAdapter.js\";\nimport { createWhereClause as n } from \"./whereUtils.js\";\nconst m = 1,\n  d = 2;\nclass p {\n  constructor(t) {\n    this._geometryBounds = i(), this._idToVisibility = new Map(), this._serviceInfo = t;\n  }\n  static async create(t) {\n    const e = new p(t);\n    return await e.update(t.filterJSON, t.spatialReference), e;\n  }\n  get hash() {\n    return this._hash;\n  }\n  check(t, e) {\n    return this._applyFilter(t, e);\n  }\n  invalidate() {\n    this._idToVisibility.forEach((t, e) => {\n      this._idToVisibility.set(e, 0);\n    });\n  }\n  setKnownIds(t) {\n    for (const e of t) this._idToVisibility.set(e, m);\n  }\n  setTrue(t) {\n    const e = [],\n      i = [],\n      s = new Set(t);\n    return this._idToVisibility.forEach((t, r) => {\n      const o = !!(this._idToVisibility.get(r) & m),\n        a = s.has(r);\n      !o && a ? e.push(r) : o && !a && i.push(r), this._idToVisibility.set(r, a ? m | d : 0);\n    }), {\n      show: e,\n      hide: i\n    };\n  }\n  createQuery() {\n    const {\n      geometry: t,\n      spatialRel: e,\n      where: i,\n      timeExtent: s,\n      objectIds: r\n    } = this;\n    return h.fromJSON({\n      geometry: t,\n      spatialRel: e,\n      where: i,\n      timeExtent: s,\n      objectIds: r\n    });\n  }\n  async update(t, e) {\n    this._hash = JSON.stringify(t);\n    const i = await r(t, null, e);\n    await Promise.all([this._setGeometryFilter(i), this._setIdFilter(i), this._setAttributeFilter(i), this._setTimeFilter(i)]);\n  }\n  async _setAttributeFilter(t) {\n    if (!t?.where) return this._clause = null, void (this.where = null);\n    this._clause = await n(t.where, this._serviceInfo.fieldsIndex), this.where = t.where;\n  }\n  _setIdFilter(t) {\n    this._idsToShow = t?.objectIds && new Set(t.objectIds), this._idsToHide = t?.hiddenIds && new Set(t.hiddenIds), this.objectIds = t?.objectIds;\n  }\n  async _setGeometryFilter(t) {\n    if (!t?.geometry) return this._spatialQueryOperator = null, this.geometry = null, void (this.spatialRel = null);\n    const e = t.geometry,\n      i = t.spatialRel ?? \"esriSpatialRelIntersects\",\n      r = await o(i, e, this._serviceInfo.geometryType, this._serviceInfo.hasZ, this._serviceInfo.hasM);\n    s(this._geometryBounds, e), this._spatialQueryOperator = r, this.geometry = e, this.spatialRel = i;\n  }\n  _setTimeFilter(i) {\n    if (this.timeExtent = this._timeOperator = null, i?.timeExtent) if (this._serviceInfo.timeInfo) this.timeExtent = i.timeExtent, this._timeOperator = a(this._serviceInfo.timeInfo, i.timeExtent, l.Shared);else {\n      const s = new t(\"feature-layer-view:time-filter-not-available\", \"Unable to apply time filter, as layer doesn't have time metadata.\", i.timeExtent);\n      e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s);\n    }\n  }\n  _applyFilter(t, e) {\n    return this._filterByGeometry(t) && this._filterById(t) && this._filterByTime(t) && this._filterByExpression(t, e);\n  }\n  _filterByExpression(t, e) {\n    return !this.where || this._clause(t, e);\n  }\n  _filterById(t) {\n    return (!this._idsToHide?.size || !this._idsToHide.has(t.getObjectId())) && (!this._idsToShow?.size || this._idsToShow.has(t.getObjectId()));\n  }\n  _filterByGeometry(t) {\n    if (!this.geometry) return !0;\n    const e = t.readGeometryWorldSpace();\n    return !!e && this._spatialQueryOperator(e);\n  }\n  _filterByTime(t) {\n    return null == this._timeOperator || this._timeOperator(t);\n  }\n}\nexport { p as default };","map":{"version":3,"names":["t","e","create","i","getBoundsXY","s","normalizeQueryLike","r","getSpatialQueryOperator","o","getTimeOperator","a","h","FeatureStoreQueryAdapter","l","createWhereClause","n","m","d","p","constructor","_geometryBounds","_idToVisibility","Map","_serviceInfo","update","filterJSON","spatialReference","hash","_hash","check","_applyFilter","invalidate","forEach","set","setKnownIds","setTrue","Set","get","has","push","show","hide","createQuery","geometry","spatialRel","where","timeExtent","objectIds","fromJSON","JSON","stringify","Promise","all","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","_clause","fieldsIndex","_idsToShow","_idsToHide","hiddenIds","_spatialQueryOperator","geometryType","hasZ","hasM","_timeOperator","timeInfo","Shared","getLogger","error","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","size","getObjectId","readGeometryWorldSpace","default"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilterEvaluator.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{create as i}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as s}from\"../../../../../geometry/support/boundsUtils.js\";import{normalizeQueryLike as r}from\"../../../../../layers/graphics/data/queryUtils.js\";import{getSpatialQueryOperator as o}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as a}from\"../../../../../layers/graphics/data/timeSupport.js\";import h from\"../../../../../rest/support/Query.js\";import{FeatureStoreQueryAdapter as l}from\"../FeatureStoreQueryAdapter.js\";import{createWhereClause as n}from\"./whereUtils.js\";const m=1,d=2;class p{constructor(t){this._geometryBounds=i(),this._idToVisibility=new Map,this._serviceInfo=t}static async create(t){const e=new p(t);return await e.update(t.filterJSON,t.spatialReference),e}get hash(){return this._hash}check(t,e){return this._applyFilter(t,e)}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,m)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&m),a=s.has(r);!o&&a?e.push(r):o&&!a&&i.push(r),this._idToVisibility.set(r,a?m|d:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return h.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await r(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t?.where)return this._clause=null,void(this.where=null);this._clause=await n(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t?.objectIds&&new Set(t.objectIds),this._idsToHide=t?.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t?.objectIds}async _setGeometryFilter(t){if(!t?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel??\"esriSpatialRelIntersects\",r=await o(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);s(this._geometryBounds,e),this._spatialQueryOperator=r,this.geometry=e,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=i.timeExtent,this._timeOperator=a(this._serviceInfo.timeInfo,i.timeExtent,l.Shared);else{const s=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",i.timeExtent);e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\").error(s)}}_applyFilter(t,e){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t,e)}_filterByExpression(t,e){return!this.where||this._clause(t,e)}_filterById(t){return(!this._idsToHide?.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readGeometryWorldSpace();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return null==this._timeOperator||this._timeOperator(t)}}export{p as default};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}