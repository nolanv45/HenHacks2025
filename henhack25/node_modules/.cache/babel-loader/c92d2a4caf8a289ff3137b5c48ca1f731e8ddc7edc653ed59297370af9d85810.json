{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport \"../../../../core/has.js\";\nimport { LRUCache as e } from \"../../../../core/LRUCache.js\";\nimport { getOrCreateMapValue as t } from \"../../../../core/MapUtils.js\";\nimport { throwIfAborted as s } from \"../../../../core/promiseUtils.js\";\nimport { getMetersPerVerticalUnitForSR as n } from \"../../../../core/unitUtils.js\";\nimport { getMetersPerUnit as o } from \"../../../../symbols/support/unitConversionUtils.js\";\nfunction i(e = !1, t) {\n  if (e) {\n    const {\n      elevationInfo: e,\n      alignPointsInFeatures: s\n    } = t;\n    return new c(e, s);\n  }\n  return new a();\n}\nclass a {\n  async alignCandidates(e, t, s) {\n    return e;\n  }\n  notifyElevationSourceChange() {}\n}\nconst r = 1024;\nclass c {\n  constructor(t, s) {\n    this._elevationInfo = t, this._alignPointsInFeatures = s, this._alignmentsCache = new e(r), this._cacheVersion = 0;\n  }\n  async alignCandidates(e, t, s) {\n    const n = this._elevationInfo;\n    return null == n || \"absolute-height\" !== n.mode || n.featureExpressionInfo ? this._alignComputedElevationCandidates(e, t, s) : (l(e, t, n), e);\n  }\n  notifyElevationSourceChange() {\n    this._alignmentsCache.clear(), this._cacheVersion++;\n  }\n  async _alignComputedElevationCandidates(e, n, o) {\n    const i = new Map();\n    for (const s of e) t(i, s.objectId, d).push(s);\n    const [a, r, c] = this._prepareQuery(i, n),\n      h = await this._alignPointsInFeatures(a, o);\n    s(o);\n    if (c !== this._cacheVersion) return this._alignComputedElevationCandidates(e, n, o);\n    this._applyCacheAndResponse(a, h, r);\n    const {\n        drapedObjectIds: u,\n        failedObjectIds: l\n      } = h,\n      p = [];\n    for (const t of e) {\n      const {\n        objectId: e\n      } = t;\n      u.has(e) && \"edge\" === t.type && (t.draped = !0), l.has(e) || p.push(t);\n    }\n    return p;\n  }\n  _prepareQuery(e, t) {\n    const s = [],\n      n = [];\n    for (const [o, i] of e) {\n      const e = [];\n      for (const t of i) this._addToQueriesOrCachedResult(o, t.target, e, n), \"edge\" === t.type && (this._addToQueriesOrCachedResult(o, t.start, e, n), this._addToQueriesOrCachedResult(o, t.end, e, n));\n      0 !== e.length && s.push({\n        objectId: o,\n        points: e\n      });\n    }\n    return [{\n      spatialReference: t.toJSON(),\n      pointsInFeatures: s\n    }, n, this._cacheVersion];\n  }\n  _addToQueriesOrCachedResult(e, t, s, n) {\n    const o = u(e, t),\n      i = this._alignmentsCache.get(o);\n    null == i ? s.push(t) : n.push(new h(t, i));\n  }\n  _applyCacheAndResponse(e, {\n    elevations: t,\n    drapedObjectIds: s,\n    failedObjectIds: n\n  }, o) {\n    for (const r of o) r.apply();\n    let i = 0;\n    const a = this._alignmentsCache;\n    for (const {\n      objectId: r,\n      points: c\n    } of e.pointsInFeatures) {\n      if (n.has(r)) {\n        i += c.length;\n        continue;\n      }\n      const e = !s.has(r);\n      for (const s of c) {\n        const n = u(r, s),\n          o = t[i++];\n        s.z = o, e && a.put(n, o, 1);\n      }\n    }\n  }\n}\nclass h {\n  constructor(e, t) {\n    this.point = e, this.z = t;\n  }\n  apply() {\n    this.point.z = this.z;\n  }\n}\nfunction u(e, {\n  x: t,\n  y: s,\n  z: n,\n  spatialReference: o\n}) {\n  return `${e}-${t}-${s}-${n ?? 0}}-wkid:${o?.wkid}`;\n}\nfunction l(e, t, s) {\n  const {\n    offset: i,\n    unit: a\n  } = s;\n  if (null == i) return;\n  const r = n(t),\n    c = i * (o(a ?? \"meters\") / r);\n  for (const n of e) switch (n.type) {\n    case \"edge\":\n      n.start.z += c, n.end.z += c;\n      continue;\n    case \"vertex\":\n      n.target.z += c;\n      continue;\n  }\n}\nfunction d() {\n  return [];\n}\nexport { i as getSnappingCandidateElevationAligner };","map":{"version":3,"names":["LRUCache","e","getOrCreateMapValue","t","throwIfAborted","s","getMetersPerVerticalUnitForSR","n","getMetersPerUnit","o","i","elevationInfo","alignPointsInFeatures","c","a","alignCandidates","notifyElevationSourceChange","r","constructor","_elevationInfo","_alignPointsInFeatures","_alignmentsCache","_cacheVersion","mode","featureExpressionInfo","_alignComputedElevationCandidates","l","clear","Map","objectId","d","push","_prepareQuery","h","_applyCacheAndResponse","drapedObjectIds","u","failedObjectIds","p","has","type","draped","_addToQueriesOrCachedResult","target","start","end","length","points","spatialReference","toJSON","pointsInFeatures","get","elevations","apply","z","put","point","x","y","wkid","offset","unit","getSnappingCandidateElevationAligner"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as n}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as o}from\"../../../../symbols/support/unitConversionUtils.js\";function i(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s}=t;return new c(e,s)}return new a}class a{async alignCandidates(e,t,s){return e}notifyElevationSourceChange(){}}const r=1024;class c{constructor(t,s){this._elevationInfo=t,this._alignPointsInFeatures=s,this._alignmentsCache=new e(r),this._cacheVersion=0}async alignCandidates(e,t,s){const n=this._elevationInfo;return null==n||\"absolute-height\"!==n.mode||n.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,s):(l(e,t,n),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,n,o){const i=new Map;for(const s of e)t(i,s.objectId,d).push(s);const[a,r,c]=this._prepareQuery(i,n),h=await this._alignPointsInFeatures(a,o);s(o);if(c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,n,o);this._applyCacheAndResponse(a,h,r);const{drapedObjectIds:u,failedObjectIds:l}=h,p=[];for(const t of e){const{objectId:e}=t;u.has(e)&&\"edge\"===t.type&&(t.draped=!0),l.has(e)||p.push(t)}return p}_prepareQuery(e,t){const s=[],n=[];for(const[o,i]of e){const e=[];for(const t of i)this._addToQueriesOrCachedResult(o,t.target,e,n),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,n),this._addToQueriesOrCachedResult(o,t.end,e,n));0!==e.length&&s.push({objectId:o,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:s},n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,s,n){const o=u(e,t),i=this._alignmentsCache.get(o);null==i?s.push(t):n.push(new h(t,i))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e.pointsInFeatures){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=u(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class h{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function u(e,{x:t,y:s,z:n,spatialReference:o}){return`${e}-${t}-${s}-${n??0}}-wkid:${o?.wkid}`}function l(e,t,s){const{offset:i,unit:a}=s;if(null==i)return;const r=n(t),c=i*(o(a??\"meters\")/r);for(const n of e)switch(n.type){case\"edge\":n.start.z+=c,n.end.z+=c;continue;case\"vertex\":n.target.z+=c;continue}}function d(){return[]}export{i as getSnappingCandidateElevationAligner};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}