{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { throwIfAborted as t } from \"../../../../core/promiseUtils.js\";\nimport { pt2px as s } from \"../../../../core/screenUtils.js\";\nimport { identity as r, scale as i, translate as a, copy as o } from \"../../../../core/libs/gl-matrix-2/math/mat4.js\";\nimport { create as n } from \"../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";\nimport { l, F as c, v as h, c as d, C as m, g as p, i as u } from \"../../../../chunks/vec32.js\";\nimport { fromArray as y, clone as f, ZEROS as _, ONES as g, fromValues as b, create as P } from \"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";\nimport { ONES as R, create as x } from \"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";\nimport { computeTranslationToOriginAndRotation as v } from \"../../../../geometry/projection/computeTranslationToOriginAndRotation.js\";\nimport { projectPointToVector as L } from \"../../../../geometry/projection/projectPointToVector.js\";\nimport { create as C, size as S, containsPoint as w, center as E } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { defaultPrimitive as j } from \"../../../../symbols/support/ObjectSymbol3DLayerResource.js\";\nimport { objectSymbolLayerPrimitiveBoundingBox as U, objectSymbolLayerSizeWithResourceSize as T } from \"../../../../symbols/support/symbolLayerUtils3D.js\";\nimport { estimateNumVerticesForLods as O, defaultSymbolLayerMemoryComplexity as B } from \"./defaultSymbolComplexity.js\";\nimport { perLodInstanceElevationAligner as G } from \"./ElevationAligners.js\";\nimport { needsElevationUpdates3D as I, evaluateElevationInfoAtPoint as D, SampleElevationInfo as F } from \"./elevationAlignmentUtils.js\";\nimport { Graphics3DLodInstanceGraphicLayer as A } from \"./Graphics3DLodInstanceGraphicLayer.js\";\nimport { Graphics3DSymbolLayer as M } from \"./Graphics3DSymbolLayer.js\";\nimport { validateSymbolLayerSize as z, mixinColorAndOpacity as V, computeObjectScale as k, computeObjectRotation as H } from \"./graphicUtils.js\";\nimport { ApplyRendererDiffResult as W } from \"./interfaces.js\";\nimport { LoadStatus as q } from \"./Loadable.js\";\nimport { makeLodResources as N } from \"./lodResourceUtils.js\";\nimport { fetch as J } from \"./objectResourceUtils.js\";\nimport { placePointOnGeometry as Y, extendPointGraphicElevationContext as $ } from \"./pointUtils.js\";\nimport { isValidPrimitive as K, primitiveLodResources as Q } from \"./primitiveObjectSymbolUtils.js\";\nimport { SymbolComplexity as X } from \"./SymbolComplexity.js\";\nimport { getResourceUrlFromSymbolStyle as Z } from \"./webStyleUtils.js\";\nimport { initFastSymbolUpdatesState as ee, updateFastSymbolUpdatesState as te, ConvertOptions as se, evaluateModelTransform as re, evaluateModelTransformScale as ie } from \"../support/FastSymbolUpdates.js\";\nimport { olidEnabled as ae } from \"../../webgl-engine/effects/geometry/olidUtils.js\";\nimport { CullFaceOptions as oe } from \"../../webgl-engine/lib/basicInterfaces.js\";\nimport { VertexAttribute as ne } from \"../../webgl-engine/lib/VertexAttribute.js\";\nimport { LodRenderer as le } from \"../../webgl-engine/lib/lodRendering/LodRenderer.js\";\nimport { DefaultMaterial as ce } from \"../../webgl-engine/materials/DefaultMaterial.js\";\nimport { schematicMRRFactors as he } from \"../../webgl-engine/materials/pbrUtils.js\";\nclass de {\n  constructor(e, t, s, r, i, a, o, n, l, c, h, d) {\n    this.lodResources = e, this.lodRenderer = t, this.stageResources = s, this.originalMaterialParameters = r, this.resourceSize = i, this.isEsriSymbolResource = a, this.isWosr = o, this.resourceBoundingBox = n, this.symbolSize = l, this.extentPadding = c, this.physicalBasedRenderingEnabled = h, this.pivotOffset = d;\n  }\n}\nclass me extends M {\n  getCachedSize() {\n    const [e, t, s] = null != this._resources ? this._resources.symbolSize : [1, 1, 1];\n    return {\n      width: e,\n      depth: t,\n      height: s\n    };\n  }\n  constructor(e, t, s, r) {\n    super(e, t, s, r), this._resources = null, this._optionalFields = new Array(), this._instanceIndexToGraphicUid = new Map(), this._hasLoadedPBRTextures = !1, this._disposeResourceHandles = new Array(), this.skipHighSymbolLodsChanged = !1, this.ensureDrapedStatus(!1), this._hasLoadedPBRTextures = s.physicalBasedRenderingEnabled;\n  }\n  async doLoad(e) {\n    if (!this._drivenProperties.size) {\n      const e = z(this.symbolLayer);\n      if (e) throw new Error(e);\n    }\n    if (this._isPrimitive) {\n      const t = this.symbolLayer.resource,\n        s = t && K(t?.primitive) ? t.primitive : j;\n      this._resources = await this._createResourcesForPrimitive(s, e);\n    } else {\n      const t = await Z(this.symbol.styleOrigin),\n        s = t?.href ?? this.symbolLayer.resource?.href;\n      this._resources = await this._createResourcesForUrl(s, e);\n    }\n    this.layerOpacityChanged(), this.slicePlaneEnabledChanged(), this.physicalBasedRenderingChanged(), this.complexity = this.computeComplexity();\n  }\n  get extentPadding() {\n    return null != this._resources ? this._resources.extentPadding : 0;\n  }\n  get _isPrimitive() {\n    return !this.symbolLayer.resource?.href;\n  }\n  get lodRenderer() {\n    return this._resources?.lodRenderer;\n  }\n  get materials() {\n    return this._resources?.stageResources.materials ?? [];\n  }\n  _setMaterialTransparencyParameters(e, t = this.symbolLayer?.material?.color) {\n    const s = this._getCombinedOpacity(t),\n      r = s < 1 || this.needsDrivenTransparentPass;\n    return e.transparent = r, e.opacity = s, e.cullFace = r ? oe.None : oe.Back, e;\n  }\n  async _createResourcesForPrimitive(t, r) {\n    const i = this.symbolLayer,\n      a = C(U(t)),\n      o = y(S(a)),\n      n = y(T(o, i)),\n      h = l(n),\n      d = !1,\n      m = !1,\n      p = this.symbolLayer?.material?.emissiveFactor,\n      u = p ? c(f(p)) : _,\n      b = {\n        usePBR: this._context.physicalBasedRenderingEnabled,\n        isSchematic: !0,\n        mrrFactors: he,\n        ambient: g,\n        diffuse: g,\n        hasSlicePlane: this._context.slicePlaneEnabled,\n        castShadows: this.symbolLayer.castShadows,\n        emissiveFactor: u,\n        offsetTransparentBackfaces: !this.symbolLayer.isPrimitive\n      },\n      P = !!b.usePBR;\n    this._setMaterialTransparencyParameters(b);\n    const x = this.symbol;\n    if (\"point-3d\" === x.type && x.verticalOffset) {\n      const {\n        screenLength: e,\n        minWorldLength: t,\n        maxWorldLength: r\n      } = x.verticalOffset;\n      b.verticalOffset = {\n        screenLength: s(e),\n        minWorldLength: t || 0,\n        maxWorldLength: null != r ? r : 1 / 0\n      }, b.castShadows = !1;\n    }\n    if (this._context.screenSizePerspectiveEnabled && (b.screenSizePerspective = this._context.sharedResources.screenSizePerspectiveSettings), this._drivenProperties.color) b.externalColor = R;else {\n      const t = null != i.material ? i.material.color : null,\n        s = null != t ? e.toUnitRGBA(t) : R;\n      b.externalColor = s;\n    }\n    this._fastUpdates = ee(this._context.renderer, this._fastVisualVariableConvertOptions(a, n, o, null)), b.isInstanced = !0, this._fastUpdates ? (Object.assign(b, this._fastUpdates.materialParameters), this._optionalFields.push(ne.FEATUREATTRIBUTE)) : this._hasPerInstanceColor() && (b.hasInstancedColor = !0, this._optionalFields.push(ne.COLOR)), ae() && this._optionalFields.push(ne.OBJECTANDLAYERIDCOLOR);\n    const v = new ce(b, this._context),\n      L = Q(t, v);\n    if (!L) throw new Error(`Unknown object symbol primitive: ${t}`);\n    const w = L.getMaterials().map(e => ({\n        opacity: 1,\n        transparent: e.parameters.transparent\n      })),\n      E = await this._createStageResources(L, P, r),\n      j = await this._createLodRenderer(L, r);\n    return new de(L, j, E, w, o, d, m, a, n, h, P, null);\n  }\n  async _createResourcesForUrl(e, t) {\n    const r = {\n        isInstanced: !0,\n        hasSlicePlane: this._context.slicePlaneEnabled,\n        castShadows: this.symbolLayer.castShadows\n      },\n      i = {\n        spherical: this._context.spherical,\n        doublePrecisionRequiresObfuscation: this._context.doublePrecisionRequiresObfuscation,\n        materialParameters: r,\n        streamDataRequester: this._context.streamDataRequester,\n        cache: this._context.sharedResources.objectResourceCache\n      };\n    this._fastUpdates = ee(this._context.renderer, this._fastVisualVariableConvertOptions(null, null, null, null)), this._fastUpdates ? (Object.assign(i.materialParameters, this._fastUpdates.materialParameters), this._optionalFields.push(ne.FEATUREATTRIBUTE)) : this._hasPerInstanceColor() && (i.materialParameters.hasInstancedColor = !0, this._optionalFields.push(ne.COLOR)), ae() && this._optionalFields.push(ne.OBJECTANDLAYERIDCOLOR);\n    const a = this.symbol;\n    if (\"point-3d\" === a.type && a.verticalOffset) {\n      const {\n        screenLength: e,\n        minWorldLength: t,\n        maxWorldLength: r\n      } = a.verticalOffset;\n      i.materialParameters.verticalOffset = {\n        screenLength: s(e),\n        minWorldLength: t || 0,\n        maxWorldLength: null != r ? r : 1 / 0\n      }, i.materialParameters.castShadows = !1;\n    }\n    const o = this._context.physicalBasedRenderingEnabled;\n    i.signal = t, i.usePBR = o, i.skipHighLods = this._context.skipHighSymbolLods;\n    const n = await J(e, i),\n      c = n.isEsriSymbolResource,\n      h = n.isWosr,\n      d = N(n.lods),\n      m = this._context,\n      p = this.symbolLayer.material,\n      u = this._getExternalColorParameters(p),\n      f = this.symbolLayer?.material?.color,\n      _ = this._getCombinedOpacity(f, {\n        hasIntrinsicColor: !0\n      }),\n      g = this.needsDrivenTransparentPass,\n      b = d.getMaterials(),\n      P = d.getMaterials().map(e => ({\n        opacity: e.parameters.opacity || 1,\n        transparent: e.parameters.transparent\n      }));\n    b.forEach(e => {\n      const t = e.parameters;\n      e.setParameters(u);\n      const s = t.opacity * _,\n        r = s < 1 || g || t.transparent;\n      e.setParameters({\n        opacity: s,\n        transparent: r\n      }), m.screenSizePerspectiveEnabled && e.setParameters({\n        screenSizePerspective: m.sharedResources.screenSizePerspectiveSettings\n      });\n    });\n    const R = n.referenceBoundingBox,\n      x = y(S(R)),\n      v = y(d.levels[0].pivotOffset),\n      L = y(T(x, this.symbolLayer)),\n      C = l(L),\n      w = this._fastUpdates;\n    te(w, this._context.renderer, this._fastVisualVariableConvertOptions(R, L, x, v)) && b.forEach(e => e.setParameters(w.materialParameters));\n    const E = await this._createStageResources(d, o, t),\n      j = await this._createLodRenderer(d, t);\n    return new de(d, j, E, P, x, c, h, R, L, C, o, v);\n  }\n  _addDisposeResource(e) {\n    this._disposeResourceHandles.push(e);\n  }\n  async _createStageResources(e, s, r) {\n    const i = this._context.stage,\n      a = e.getMaterials();\n    s !== this._context.physicalBasedRenderingEnabled && this.physicalBasedRenderingChanged(), i.addMany(a), this._addDisposeResource(() => i.removeMany(a));\n    const o = e.getTextures();\n    i.addMany(o), this._addDisposeResource(() => {\n      o.forEach(e => e.unload()), i.removeMany(o);\n    }), await Promise.all(o.map(e => this._context.stage.schedule(() => e.load(i.renderView.renderingContext), r))), t(r);\n    const n = e.getEngineGeometries();\n    return i.addMany(n), this._addDisposeResource(() => i.removeMany(n)), {\n      materials: a,\n      textures: o,\n      geometries: n\n    };\n  }\n  async _createLodRenderer(e, t) {\n    const s = this._context.stage,\n      r = {\n        layerUid: this._context.layer.uid,\n        graphicUid: e => this._instanceIndexToGraphicUid.get(e),\n        notifyGraphicGeometryChanged: e => this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),\n        notifyGraphicVisibilityChanged: e => this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))\n      },\n      i = this._fastUpdates,\n      a = i ? {\n        applyTransform: (e, t, s) => {\n          e.getFeatureAttribute(t, ge), o(s, re(i.materialParameters, ge, s));\n        },\n        scaleFactor: (e, t, s) => {\n          t.getFeatureAttribute(s, ge), ie(e, i.materialParameters, ge);\n        }\n      } : null,\n      n = new le({\n        symbol: e,\n        optionalFields: this._optionalFields,\n        metadata: r,\n        shaderTransformation: a\n      }, this._context.scheduler);\n    return n.slicePlaneEnabled = this._context.slicePlaneEnabled, this._addDisposeResource(() => {\n      s.removeRenderPlugin(n), n.destroy();\n    }), await s.addRenderPlugin(n, t), n;\n  }\n  _getExternalColorParameters(t) {\n    const s = {};\n    return this._drivenProperties.color ? s.externalColor = R : null != t?.color ? s.externalColor = e.toUnitRGBA(t.color) : (s.externalColor = R, s.colorMixMode = \"ignore\"), s;\n  }\n  destroy() {\n    super.destroy(), this._cleanupResources();\n  }\n  _cleanupResources() {\n    this._disposeResourceHandles.forEach(e => e()), this._disposeResourceHandles.length = 0, this._resources = null;\n  }\n  createGraphics3DGraphic(e) {\n    const t = e.graphic;\n    if (!this._validateGeometry(t.geometry)) return null;\n    const s = Y(t.geometry);\n    if (null == s) return this.logger.warn(`unsupported geometry type for object symbol: ${t.geometry.type}`), null;\n    const r = this.setGraphicElevationContext(t),\n      i = e.renderingInfo;\n    return this._createAs3DShape(t, s, i, r, t.uid, e.layer.uid);\n  }\n  notifyDestroyGraphicLayer(e) {\n    this._instanceIndexToGraphicUid.delete(e.instanceIndex);\n  }\n  graphicLayerToGraphicId() {\n    return 0;\n  }\n  layerOpacityChanged() {\n    if (null == this._resources) return;\n    const e = this._drivenProperties.opacity,\n      t = !this._isPrimitive,\n      s = this._resources.stageResources.materials,\n      r = this._resources.originalMaterialParameters;\n    for (let i = 0; i < s.length; i++) {\n      const a = s[i],\n        o = this.symbolLayer?.material?.color,\n        n = r[i],\n        l = this._getCombinedOpacity(o, {\n          hasIntrinsicColor: t\n        }) * n.opacity,\n        c = l < 1 || e || n.transparent;\n      a.setParameters({\n        opacity: l,\n        transparent: c\n      }), this._isPrimitive && a.setParameters({\n        cullFace: c ? oe.None : oe.Back\n      });\n    }\n  }\n  layerElevationInfoChanged(e, t) {\n    return this.updateGraphics3DGraphicElevationInfo(e, t, I);\n  }\n  slicePlaneEnabledChanged() {\n    if (null == this._resources) return !0;\n    this._resources.lodRenderer.slicePlaneEnabled = this._context.slicePlaneEnabled;\n    for (const e of this._resources.stageResources.materials) e.setParameters({\n      hasSlicePlane: this._context.slicePlaneEnabled\n    });\n    return !0;\n  }\n  physicalBasedRenderingChanged() {\n    if (null == this._resources) return !0;\n    const {\n      stageResources: e,\n      isWosr: t\n    } = this._resources;\n    for (const s of e.materials) this._isPrimitive ? s.setParameters({\n      usePBR: this._context.physicalBasedRenderingEnabled,\n      isSchematic: !0\n    }) : t || s.setParameters({\n      usePBR: this._context.physicalBasedRenderingEnabled,\n      isSchematic: !1\n    });\n    return !1 !== this._hasLoadedPBRTextures || !0 !== this._context.physicalBasedRenderingEnabled || (this._hasLoadedPBRTextures = !0, !1);\n  }\n  applyRendererDiff(e, t) {\n    if (null == this._resources) return W.RecreateSymbol;\n    const {\n      stageResources: {\n        materials: s\n      },\n      lodRenderer: r,\n      resourceBoundingBox: i,\n      symbolSize: a,\n      resourceSize: o,\n      pivotOffset: n\n    } = this._resources;\n    for (const l in e.diff) {\n      if (\"visualVariables\" !== l) return W.RecreateSymbol;\n      if (!te(this._fastUpdates, t, this._fastVisualVariableConvertOptions(i, a, o, n))) return W.RecreateSymbol;\n      for (const e of s) e.setParameters(this._fastUpdates.materialParameters);\n      r.notifyShaderTransformationChanged();\n    }\n    return W.FastUpdate;\n  }\n  computeComplexity() {\n    if (null == this._resources) return super.computeComplexity();\n    const e = this._resources.lodResources,\n      t = O(e.levels),\n      s = e.computeUsedMemory(),\n      r = {\n        ...B(this.symbol, this.symbolLayer),\n        resourceBytes: s\n      };\n    return new X({\n      verticesPerFeature: t,\n      memory: r\n    });\n  }\n  _hasLodRenderer() {\n    return null != this._resources;\n  }\n  _createAs3DShape(e, t, s, r, i, a) {\n    if (!this._hasLodRenderer() || null == this._resources) return null;\n    const o = this.getFastUpdateAttrValues(e),\n      n = this._context.clippingExtent;\n    if (L(t, ye, this._context.elevationProvider.spatialReference), null != n && !w(n, ye)) return null;\n    const l = ue(r),\n      c = this._computeGlobalTransform(t, r, _e, be),\n      h = this._computeLocalTransform(this._resources, this.symbolLayer, s, fe),\n      d = this._resources.lodRenderer.instanceData,\n      m = d.addInstance();\n    this._instanceIndexToGraphicUid.set(m, i), d.setLocalTransform(m, h, !1), d.setGlobalTransform(m, c), o && d.setFeatureAttribute(m, o), null == this._fastUpdates && this._hasPerInstanceColor() && d.setColor(m, V(s.color, s.opacity, 255));\n    const p = this._context.stage.renderView.olidRenderHelper;\n    p && d.setObjectAndLayerIdColor(m, p.getObjectAndLayerIdColor({\n      graphicUid: i,\n      layerUid: a\n    }));\n    const u = new A(this, m, G, r, this._context.stage.view.state.highlightOrderMap);\n    return l && (u.alignedSampledElevation = be.sampledElevation), u.needsElevationUpdates = I(r.mode), $(u, t, this._context.elevationProvider), u;\n  }\n  _computeGlobalTransform(e, t, s, r) {\n    return D(e, this._context.elevationProvider, t, this._context.renderCoordsHelper, r), ye[0] = e.x, ye[1] = e.y, ye[2] = r.z, v(e.spatialReference, ye, s, this._context.renderCoordsHelper.spatialReference), s;\n  }\n  _computeLocalTransform(e, t, s, i) {\n    return r(i), this._applyObjectRotation(s, !1, i), this._applyObjectRotation(t, !0, i), this._applyObjectScale(e, s, i), this._applyAnchor(e, t, i), i;\n  }\n  _applyObjectScale(e, t, s) {\n    if (this._fastUpdates?.requiresShaderTransformation) return;\n    const r = this._drivenProperties.size && t.size ? t.size : e.symbolSize,\n      a = k(r, e.symbolSize, e.resourceSize, this._context.renderCoordsHelper.unitInMeters);\n    1 === a[0] && 1 === a[1] && 1 === a[2] || i(s, s, a);\n  }\n  prepareSymbolLayerPatch(e) {\n    if (\"partial\" !== e.diff.type) return;\n    const t = e.diff.diff;\n    this._preparePatchTransform(e, t), this._preparePatchColor(e, t);\n  }\n  updateGeometry(e, t) {\n    if (null == this._resources) return !0;\n    const s = t && Y(t);\n    if (null == s) return !1;\n    const r = this.getGeometryElevationMode(t);\n    return e.elevationContext.mode === r && (this._computeGlobalTransform(s, e.elevationContext, _e, be), ue(e.elevationContext) && (e.alignedSampledElevation = be.sampledElevation), this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex, _e, !0), $(e, s, this._context.elevationProvider), !0);\n  }\n  _preparePatchTransform(e, t) {\n    if (!(t.heading || t.tilt || t.roll || t.width || t.height || t.depth || t.anchor || t.anchorPosition)) return;\n    if (null == this._resources) return;\n    const s = (e, t, s) => (null != e && \"complete\" === e.type ? e.newValue : t) ?? s,\n      r = s(t.heading, this.symbolLayer.heading, 0),\n      i = s(t.tilt, this.symbolLayer.tilt, 0),\n      a = s(t.roll, this.symbolLayer.roll, 0),\n      o = s(t.width, this.symbolLayer.width, void 0),\n      n = s(t.height, this.symbolLayer.height, void 0),\n      l = s(t.depth, this.symbolLayer.depth, void 0),\n      c = s(t.anchor, this.symbolLayer.anchor, void 0),\n      h = s(t.anchorPosition, this.symbolLayer.anchorPosition, void 0);\n    delete t.heading, delete t.tilt, delete t.roll, delete t.width, delete t.height, delete t.depth, delete t.anchor, delete t.anchorPosition;\n    const d = {\n        heading: r,\n        tilt: i,\n        roll: a,\n        anchor: c,\n        anchorPosition: h\n      },\n      m = this._resources;\n    this.loadStatus === q.LOADED && e.symbolLayerStatePatches.push(() => {\n      m.symbolSize = y(T(m.resourceSize, {\n        width: o,\n        height: n,\n        depth: l,\n        isPrimitive: this.symbolLayer.isPrimitive\n      }));\n    }), e.graphics3DGraphicPatches.push(({\n      instanceIndex: e\n    }, t) => {\n      const s = this._computeLocalTransform(m, d, t, fe);\n      m.lodRenderer.instanceData.setLocalTransform(e, s, !0);\n    });\n  }\n  _preparePatchColor(t, s) {\n    if (!s.material || \"partial\" !== s.material.type) return;\n    const r = s.material.diff;\n    if (!r.color || \"complete\" !== r.color.type || null == r.color.newValue || null == r.color.oldValue) return;\n    const i = r.color.newValue,\n      a = null != i ? e.toUnitRGBA(i) : R;\n    delete r.color;\n    const o = this._resources;\n    null != o && t.graphics3DGraphicPatches.push(({\n      instanceIndex: e\n    }) => {\n      let t;\n      this._hasPerInstanceColor() ? (o.lodRenderer.instanceData.setColor(e, a), t = this._setMaterialTransparencyParameters({}, i)) : t = this._setMaterialTransparencyParameters({\n        externalColor: a\n      }, i);\n      for (const s of o.stageResources.materials) s.setParameters(t);\n    });\n  }\n  _applyObjectRotation(e, t, s) {\n    if (!this._fastUpdates?.requiresShaderTransformation || !t) return H(e.heading, e.tilt, e.roll, s);\n  }\n  _applyAnchor(e, t, s) {\n    if (this._fastUpdates?.requiresShaderTransformation) return;\n    const r = pe(e.resourceBoundingBox, e.pivotOffset, t);\n    r && a(s, s, r);\n  }\n  _hasPerInstanceColor() {\n    return this._drivenProperties.color || this._drivenProperties.opacity;\n  }\n  _fastVisualVariableConvertOptions(e, t, s, r) {\n    const i = null != e ? y(S(e)) : g,\n      a = null != e ? pe(e, r, this.symbolLayer) : _,\n      o = this._context.renderCoordsHelper.unitInMeters,\n      n = k(null != t ? t : void 0, t, s, o),\n      l = b(this.symbolLayer.tilt || 0, this.symbolLayer.roll || 0, this.symbolLayer.heading || 0);\n    return new se({\n      size: !0,\n      color: !0,\n      rotation: !0,\n      opacity: !1\n    }, i, t ?? g, o, a, n, l);\n  }\n}\nfunction pe(e, t, s) {\n  const r = P();\n  switch (s.anchor) {\n    case \"center\":\n      d(r, E(e)), h(r, r);\n      break;\n    case \"top\":\n      {\n        const t = E(e);\n        u(r, -t[0], -t[1], -e[5]);\n        break;\n      }\n    case \"bottom\":\n      {\n        const t = E(e);\n        u(r, -t[0], -t[1], -e[2]);\n        break;\n      }\n    case \"relative\":\n      {\n        const t = E(e),\n          i = S(e),\n          a = s.anchorPosition,\n          o = a ? b(a.x, a.y, a.z) : _;\n        m(r, i, o), p(r, r, t), h(r, r);\n        break;\n      }\n    default:\n      null != t ? h(r, t) : d(r, _);\n  }\n  return r;\n}\nfunction ue(e) {\n  return \"absolute-height\" !== e.mode;\n}\nconst ye = P(),\n  fe = n(),\n  _e = n(),\n  ge = x(),\n  be = new F();\nexport { me as Graphics3DObjectSymbolLayer };","map":{"version":3,"names":["e","throwIfAborted","t","pt2px","s","identity","r","scale","i","translate","a","copy","o","create","n","l","F","c","v","h","d","C","m","g","p","u","fromArray","y","clone","f","ZEROS","_","ONES","fromValues","b","P","R","x","computeTranslationToOriginAndRotation","projectPointToVector","L","size","S","containsPoint","w","center","E","defaultPrimitive","j","objectSymbolLayerPrimitiveBoundingBox","U","objectSymbolLayerSizeWithResourceSize","T","estimateNumVerticesForLods","O","defaultSymbolLayerMemoryComplexity","B","perLodInstanceElevationAligner","G","needsElevationUpdates3D","I","evaluateElevationInfoAtPoint","D","SampleElevationInfo","Graphics3DLodInstanceGraphicLayer","A","Graphics3DSymbolLayer","M","validateSymbolLayerSize","z","mixinColorAndOpacity","V","computeObjectScale","k","computeObjectRotation","H","ApplyRendererDiffResult","W","LoadStatus","q","makeLodResources","N","fetch","J","placePointOnGeometry","Y","extendPointGraphicElevationContext","$","isValidPrimitive","K","primitiveLodResources","Q","SymbolComplexity","X","getResourceUrlFromSymbolStyle","Z","initFastSymbolUpdatesState","ee","updateFastSymbolUpdatesState","te","ConvertOptions","se","evaluateModelTransform","re","evaluateModelTransformScale","ie","olidEnabled","ae","CullFaceOptions","oe","VertexAttribute","ne","LodRenderer","le","DefaultMaterial","ce","schematicMRRFactors","he","de","constructor","lodResources","lodRenderer","stageResources","originalMaterialParameters","resourceSize","isEsriSymbolResource","isWosr","resourceBoundingBox","symbolSize","extentPadding","physicalBasedRenderingEnabled","pivotOffset","me","getCachedSize","_resources","width","depth","height","_optionalFields","Array","_instanceIndexToGraphicUid","Map","_hasLoadedPBRTextures","_disposeResourceHandles","skipHighSymbolLodsChanged","ensureDrapedStatus","doLoad","_drivenProperties","symbolLayer","Error","_isPrimitive","resource","primitive","_createResourcesForPrimitive","symbol","styleOrigin","href","_createResourcesForUrl","layerOpacityChanged","slicePlaneEnabledChanged","physicalBasedRenderingChanged","complexity","computeComplexity","materials","_setMaterialTransparencyParameters","material","color","_getCombinedOpacity","needsDrivenTransparentPass","transparent","opacity","cullFace","None","Back","emissiveFactor","usePBR","_context","isSchematic","mrrFactors","ambient","diffuse","hasSlicePlane","slicePlaneEnabled","castShadows","offsetTransparentBackfaces","isPrimitive","type","verticalOffset","screenLength","minWorldLength","maxWorldLength","screenSizePerspectiveEnabled","screenSizePerspective","sharedResources","screenSizePerspectiveSettings","externalColor","toUnitRGBA","_fastUpdates","renderer","_fastVisualVariableConvertOptions","isInstanced","Object","assign","materialParameters","push","FEATUREATTRIBUTE","_hasPerInstanceColor","hasInstancedColor","COLOR","OBJECTANDLAYERIDCOLOR","getMaterials","map","parameters","_createStageResources","_createLodRenderer","spherical","doublePrecisionRequiresObfuscation","streamDataRequester","cache","objectResourceCache","signal","skipHighLods","skipHighSymbolLods","lods","_getExternalColorParameters","hasIntrinsicColor","forEach","setParameters","referenceBoundingBox","levels","_addDisposeResource","stage","addMany","removeMany","getTextures","unload","Promise","all","schedule","load","renderView","renderingContext","getEngineGeometries","textures","geometries","layerUid","layer","uid","graphicUid","get","notifyGraphicGeometryChanged","notifyGraphicVisibilityChanged","applyTransform","getFeatureAttribute","ge","scaleFactor","optionalFields","metadata","shaderTransformation","scheduler","removeRenderPlugin","destroy","addRenderPlugin","colorMixMode","_cleanupResources","length","createGraphics3DGraphic","graphic","_validateGeometry","geometry","logger","warn","setGraphicElevationContext","renderingInfo","_createAs3DShape","notifyDestroyGraphicLayer","delete","instanceIndex","graphicLayerToGraphicId","layerElevationInfoChanged","updateGraphics3DGraphicElevationInfo","applyRendererDiff","RecreateSymbol","diff","notifyShaderTransformationChanged","FastUpdate","computeUsedMemory","resourceBytes","verticesPerFeature","memory","_hasLodRenderer","getFastUpdateAttrValues","clippingExtent","ye","elevationProvider","spatialReference","ue","_computeGlobalTransform","_e","be","_computeLocalTransform","fe","instanceData","addInstance","set","setLocalTransform","setGlobalTransform","setFeatureAttribute","setColor","olidRenderHelper","setObjectAndLayerIdColor","getObjectAndLayerIdColor","view","state","highlightOrderMap","alignedSampledElevation","sampledElevation","needsElevationUpdates","mode","renderCoordsHelper","_applyObjectRotation","_applyObjectScale","_applyAnchor","requiresShaderTransformation","unitInMeters","prepareSymbolLayerPatch","_preparePatchTransform","_preparePatchColor","updateGeometry","getGeometryElevationMode","elevationContext","heading","tilt","roll","anchor","anchorPosition","newValue","loadStatus","LOADED","symbolLayerStatePatches","graphics3DGraphicPatches","oldValue","pe","rotation","Graphics3DObjectSymbolLayer"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectSymbolLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{throwIfAborted as t}from\"../../../../core/promiseUtils.js\";import{pt2px as s}from\"../../../../core/screenUtils.js\";import{identity as r,scale as i,translate as a,copy as o}from\"../../../../core/libs/gl-matrix-2/math/mat4.js\";import{create as n}from\"../../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{l,F as c,v as h,c as d,C as m,g as p,i as u}from\"../../../../chunks/vec32.js\";import{fromArray as y,clone as f,ZEROS as _,ONES as g,fromValues as b,create as P}from\"../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{ONES as R,create as x}from\"../../../../core/libs/gl-matrix-2/factories/vec4f64.js\";import{computeTranslationToOriginAndRotation as v}from\"../../../../geometry/projection/computeTranslationToOriginAndRotation.js\";import{projectPointToVector as L}from\"../../../../geometry/projection/projectPointToVector.js\";import{create as C,size as S,containsPoint as w,center as E}from\"../../../../geometry/support/aaBoundingBox.js\";import{defaultPrimitive as j}from\"../../../../symbols/support/ObjectSymbol3DLayerResource.js\";import{objectSymbolLayerPrimitiveBoundingBox as U,objectSymbolLayerSizeWithResourceSize as T}from\"../../../../symbols/support/symbolLayerUtils3D.js\";import{estimateNumVerticesForLods as O,defaultSymbolLayerMemoryComplexity as B}from\"./defaultSymbolComplexity.js\";import{perLodInstanceElevationAligner as G}from\"./ElevationAligners.js\";import{needsElevationUpdates3D as I,evaluateElevationInfoAtPoint as D,SampleElevationInfo as F}from\"./elevationAlignmentUtils.js\";import{Graphics3DLodInstanceGraphicLayer as A}from\"./Graphics3DLodInstanceGraphicLayer.js\";import{Graphics3DSymbolLayer as M}from\"./Graphics3DSymbolLayer.js\";import{validateSymbolLayerSize as z,mixinColorAndOpacity as V,computeObjectScale as k,computeObjectRotation as H}from\"./graphicUtils.js\";import{ApplyRendererDiffResult as W}from\"./interfaces.js\";import{LoadStatus as q}from\"./Loadable.js\";import{makeLodResources as N}from\"./lodResourceUtils.js\";import{fetch as J}from\"./objectResourceUtils.js\";import{placePointOnGeometry as Y,extendPointGraphicElevationContext as $}from\"./pointUtils.js\";import{isValidPrimitive as K,primitiveLodResources as Q}from\"./primitiveObjectSymbolUtils.js\";import{SymbolComplexity as X}from\"./SymbolComplexity.js\";import{getResourceUrlFromSymbolStyle as Z}from\"./webStyleUtils.js\";import{initFastSymbolUpdatesState as ee,updateFastSymbolUpdatesState as te,ConvertOptions as se,evaluateModelTransform as re,evaluateModelTransformScale as ie}from\"../support/FastSymbolUpdates.js\";import{olidEnabled as ae}from\"../../webgl-engine/effects/geometry/olidUtils.js\";import{CullFaceOptions as oe}from\"../../webgl-engine/lib/basicInterfaces.js\";import{VertexAttribute as ne}from\"../../webgl-engine/lib/VertexAttribute.js\";import{LodRenderer as le}from\"../../webgl-engine/lib/lodRendering/LodRenderer.js\";import{DefaultMaterial as ce}from\"../../webgl-engine/materials/DefaultMaterial.js\";import{schematicMRRFactors as he}from\"../../webgl-engine/materials/pbrUtils.js\";class de{constructor(e,t,s,r,i,a,o,n,l,c,h,d){this.lodResources=e,this.lodRenderer=t,this.stageResources=s,this.originalMaterialParameters=r,this.resourceSize=i,this.isEsriSymbolResource=a,this.isWosr=o,this.resourceBoundingBox=n,this.symbolSize=l,this.extentPadding=c,this.physicalBasedRenderingEnabled=h,this.pivotOffset=d}}class me extends M{getCachedSize(){const[e,t,s]=null!=this._resources?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:s}}constructor(e,t,s,r){super(e,t,s,r),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=s.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size){const e=z(this.symbolLayer);if(e)throw new Error(e)}if(this._isPrimitive){const t=this.symbolLayer.resource,s=t&&K(t?.primitive)?t.primitive:j;this._resources=await this._createResourcesForPrimitive(s,e)}else{const t=await Z(this.symbol.styleOrigin),s=t?.href??this.symbolLayer.resource?.href;this._resources=await this._createResourcesForUrl(s,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(e,t=this.symbolLayer?.material?.color){const s=this._getCombinedOpacity(t),r=s<1||this.needsDrivenTransparentPass;return e.transparent=r,e.opacity=s,e.cullFace=r?oe.None:oe.Back,e}async _createResourcesForPrimitive(t,r){const i=this.symbolLayer,a=C(U(t)),o=y(S(a)),n=y(T(o,i)),h=l(n),d=!1,m=!1,p=this.symbolLayer?.material?.emissiveFactor,u=p?c(f(p)):_,b={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:he,ambient:g,diffuse:g,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,emissiveFactor:u,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},P=!!b.usePBR;this._setMaterialTransparencyParameters(b);const x=this.symbol;if(\"point-3d\"===x.type&&x.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=x.verticalOffset;b.verticalOffset={screenLength:s(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},b.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)b.externalColor=R;else{const t=null!=i.material?i.material.color:null,s=null!=t?e.toUnitRGBA(t):R;b.externalColor=s}this._fastUpdates=ee(this._context.renderer,this._fastVisualVariableConvertOptions(a,n,o,null)),b.isInstanced=!0,this._fastUpdates?(Object.assign(b,this._fastUpdates.materialParameters),this._optionalFields.push(ne.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(b.hasInstancedColor=!0,this._optionalFields.push(ne.COLOR)),ae()&&this._optionalFields.push(ne.OBJECTANDLAYERIDCOLOR);const v=new ce(b,this._context),L=Q(t,v);if(!L)throw new Error(`Unknown object symbol primitive: ${t}`);const w=L.getMaterials().map((e=>({opacity:1,transparent:e.parameters.transparent}))),E=await this._createStageResources(L,P,r),j=await this._createLodRenderer(L,r);return new de(L,j,E,w,o,d,m,a,n,h,P,null)}async _createResourcesForUrl(e,t){const r={isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},i={spherical:this._context.spherical,doublePrecisionRequiresObfuscation:this._context.doublePrecisionRequiresObfuscation,materialParameters:r,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=ee(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(ne.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(ne.COLOR)),ae()&&this._optionalFields.push(ne.OBJECTANDLAYERIDCOLOR);const a=this.symbol;if(\"point-3d\"===a.type&&a.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=a.verticalOffset;i.materialParameters.verticalOffset={screenLength:s(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},i.materialParameters.castShadows=!1}const o=this._context.physicalBasedRenderingEnabled;i.signal=t,i.usePBR=o,i.skipHighLods=this._context.skipHighSymbolLods;const n=await J(e,i),c=n.isEsriSymbolResource,h=n.isWosr,d=N(n.lods),m=this._context,p=this.symbolLayer.material,u=this._getExternalColorParameters(p),f=this.symbolLayer?.material?.color,_=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),g=this.needsDrivenTransparentPass,b=d.getMaterials(),P=d.getMaterials().map((e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent})));b.forEach((e=>{const t=e.parameters;e.setParameters(u);const s=t.opacity*_,r=s<1||g||t.transparent;e.setParameters({opacity:s,transparent:r}),m.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:m.sharedResources.screenSizePerspectiveSettings})}));const R=n.referenceBoundingBox,x=y(S(R)),v=y(d.levels[0].pivotOffset),L=y(T(x,this.symbolLayer)),C=l(L),w=this._fastUpdates;te(w,this._context.renderer,this._fastVisualVariableConvertOptions(R,L,x,v))&&b.forEach((e=>e.setParameters(w.materialParameters)));const E=await this._createStageResources(d,o,t),j=await this._createLodRenderer(d,t);return new de(d,j,E,P,x,c,h,R,L,C,o,v)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,s,r){const i=this._context.stage,a=e.getMaterials();s!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(a),this._addDisposeResource((()=>i.removeMany(a)));const o=e.getTextures();i.addMany(o),this._addDisposeResource((()=>{o.forEach((e=>e.unload())),i.removeMany(o)})),await Promise.all(o.map((e=>this._context.stage.schedule((()=>e.load(i.renderView.renderingContext)),r)))),t(r);const n=e.getEngineGeometries();return i.addMany(n),this._addDisposeResource((()=>i.removeMany(n))),{materials:a,textures:o,geometries:n}}async _createLodRenderer(e,t){const s=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},i=this._fastUpdates,a=i?{applyTransform:(e,t,s)=>{e.getFeatureAttribute(t,ge),o(s,re(i.materialParameters,ge,s))},scaleFactor:(e,t,s)=>{t.getFeatureAttribute(s,ge),ie(e,i.materialParameters,ge)}}:null,n=new le({symbol:e,optionalFields:this._optionalFields,metadata:r,shaderTransformation:a},this._context.scheduler);return n.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((()=>{s.removeRenderPlugin(n),n.destroy()})),await s.addRenderPlugin(n,t),n}_getExternalColorParameters(t){const s={};return this._drivenProperties.color?s.externalColor=R:null!=t?.color?s.externalColor=e.toUnitRGBA(t.color):(s.externalColor=R,s.colorMixMode=\"ignore\"),s}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach((e=>e())),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const s=Y(t.geometry);if(null==s)return this.logger.warn(`unsupported geometry type for object symbol: ${t.geometry.type}`),null;const r=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,s,i,r,t.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null==this._resources)return;const e=this._drivenProperties.opacity,t=!this._isPrimitive,s=this._resources.stageResources.materials,r=this._resources.originalMaterialParameters;for(let i=0;i<s.length;i++){const a=s[i],o=this.symbolLayer?.material?.color,n=r[i],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*n.opacity,c=l<1||e||n.transparent;a.setParameters({opacity:l,transparent:c}),this._isPrimitive&&a.setParameters({cullFace:c?oe.None:oe.Back})}}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,I)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const{stageResources:e,isWosr:t}=this._resources;for(const s of e.materials)this._isPrimitive?s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||s.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,t){if(null==this._resources)return W.RecreateSymbol;const{stageResources:{materials:s},lodRenderer:r,resourceBoundingBox:i,symbolSize:a,resourceSize:o,pivotOffset:n}=this._resources;for(const l in e.diff){if(\"visualVariables\"!==l)return W.RecreateSymbol;if(!te(this._fastUpdates,t,this._fastVisualVariableConvertOptions(i,a,o,n)))return W.RecreateSymbol;for(const e of s)e.setParameters(this._fastUpdates.materialParameters);r.notifyShaderTransformationChanged()}return W.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();const e=this._resources.lodResources,t=O(e.levels),s=e.computeUsedMemory(),r={...B(this.symbol,this.symbolLayer),resourceBytes:s};return new X({verticesPerFeature:t,memory:r})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(e,t,s,r,i,a){if(!this._hasLodRenderer()||null==this._resources)return null;const o=this.getFastUpdateAttrValues(e),n=this._context.clippingExtent;if(L(t,ye,this._context.elevationProvider.spatialReference),null!=n&&!w(n,ye))return null;const l=ue(r),c=this._computeGlobalTransform(t,r,_e,be),h=this._computeLocalTransform(this._resources,this.symbolLayer,s,fe),d=this._resources.lodRenderer.instanceData,m=d.addInstance();this._instanceIndexToGraphicUid.set(m,i),d.setLocalTransform(m,h,!1),d.setGlobalTransform(m,c),o&&d.setFeatureAttribute(m,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&d.setColor(m,V(s.color,s.opacity,255));const p=this._context.stage.renderView.olidRenderHelper;p&&d.setObjectAndLayerIdColor(m,p.getObjectAndLayerIdColor({graphicUid:i,layerUid:a}));const u=new A(this,m,G,r,this._context.stage.view.state.highlightOrderMap);return l&&(u.alignedSampledElevation=be.sampledElevation),u.needsElevationUpdates=I(r.mode),$(u,t,this._context.elevationProvider),u}_computeGlobalTransform(e,t,s,r){return D(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,r),ye[0]=e.x,ye[1]=e.y,ye[2]=r.z,v(e.spatialReference,ye,s,this._context.renderCoordsHelper.spatialReference),s}_computeLocalTransform(e,t,s,i){return r(i),this._applyObjectRotation(s,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,s,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,s){if(this._fastUpdates?.requiresShaderTransformation)return;const r=this._drivenProperties.size&&t.size?t.size:e.symbolSize,a=k(r,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===a[0]&&1===a[1]&&1===a[2]||i(s,s,a)}prepareSymbolLayerPatch(e){if(\"partial\"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(null==this._resources)return!0;const s=t&&Y(t);if(null==s)return!1;const r=this.getGeometryElevationMode(t);return e.elevationContext.mode===r&&(this._computeGlobalTransform(s,e.elevationContext,_e,be),ue(e.elevationContext)&&(e.alignedSampledElevation=be.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,_e,!0),$(e,s,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(null==this._resources)return;const s=(e,t,s)=>(null!=e&&\"complete\"===e.type?e.newValue:t)??s,r=s(t.heading,this.symbolLayer.heading,0),i=s(t.tilt,this.symbolLayer.tilt,0),a=s(t.roll,this.symbolLayer.roll,0),o=s(t.width,this.symbolLayer.width,void 0),n=s(t.height,this.symbolLayer.height,void 0),l=s(t.depth,this.symbolLayer.depth,void 0),c=s(t.anchor,this.symbolLayer.anchor,void 0),h=s(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const d={heading:r,tilt:i,roll:a,anchor:c,anchorPosition:h},m=this._resources;this.loadStatus===q.LOADED&&e.symbolLayerStatePatches.push((()=>{m.symbolSize=y(T(m.resourceSize,{width:o,height:n,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((({instanceIndex:e},t)=>{const s=this._computeLocalTransform(m,d,t,fe);m.lodRenderer.instanceData.setLocalTransform(e,s,!0)}))}_preparePatchColor(t,s){if(!s.material||\"partial\"!==s.material.type)return;const r=s.material.diff;if(!r.color||\"complete\"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,a=null!=i?e.toUnitRGBA(i):R;delete r.color;const o=this._resources;null!=o&&t.graphics3DGraphicPatches.push((({instanceIndex:e})=>{let t;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(e,a),t=this._setMaterialTransparencyParameters({},i)):t=this._setMaterialTransparencyParameters({externalColor:a},i);for(const s of o.stageResources.materials)s.setParameters(t)}))}_applyObjectRotation(e,t,s){if(!this._fastUpdates?.requiresShaderTransformation||!t)return H(e.heading,e.tilt,e.roll,s)}_applyAnchor(e,t,s){if(this._fastUpdates?.requiresShaderTransformation)return;const r=pe(e.resourceBoundingBox,e.pivotOffset,t);r&&a(s,s,r)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,s,r){const i=null!=e?y(S(e)):g,a=null!=e?pe(e,r,this.symbolLayer):_,o=this._context.renderCoordsHelper.unitInMeters,n=k(null!=t?t:void 0,t,s,o),l=b(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new se({size:!0,color:!0,rotation:!0,opacity:!1},i,t??g,o,a,n,l)}}function pe(e,t,s){const r=P();switch(s.anchor){case\"center\":d(r,E(e)),h(r,r);break;case\"top\":{const t=E(e);u(r,-t[0],-t[1],-e[5]);break}case\"bottom\":{const t=E(e);u(r,-t[0],-t[1],-e[2]);break}case\"relative\":{const t=E(e),i=S(e),a=s.anchorPosition,o=a?b(a.x,a.y,a.z):_;m(r,i,o),p(r,r,t),h(r,r);break}default:null!=t?h(r,t):d(r,_)}return r}function ue(e){return\"absolute-height\"!==e.mode}const ye=P(),fe=n(),_e=n(),ge=x(),be=new F;export{me as Graphics3DObjectSymbolLayer};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}