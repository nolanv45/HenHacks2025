{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { handlesGroup as t } from \"../../../../../../core/handleUtils.js\";\nimport { getOrCreateMapValue as e } from \"../../../../../../core/MapUtils.js\";\nimport { isAborted as s, throwIfAborted as o, onAbort as r } from \"../../../../../../core/promiseUtils.js\";\nimport { ATileLoadStrategy as i } from \"./ATileLoadStrategy.js\";\nimport { PagedTileSourceChunk as a } from \"./chunks/PagedTileSourceChunk.js\";\nimport { FeatureSetReaderJSON as n } from \"../../support/FeatureSetReaderJSON.js\";\nclass l {\n  constructor(e, s) {\n    this.subscription = e, this._pages = new Set(), this._controller = new AbortController(), this._done = !1, this._handles = t([r(e.signal, () => this._controller.abort()), r(s, () => this._controller.abort())]);\n  }\n  destroy() {\n    this._controller.abort(), this._handles.remove();\n  }\n  get pageStart() {\n    let t = -1;\n    for (const e of this._pages.values()) t = Math.max(t, e);\n    return t + 1;\n  }\n  get done() {\n    return this._done;\n  }\n  get options() {\n    return {\n      signal: this._controller.signal\n    };\n  }\n  add(t, e) {\n    this._pages.add(t), this._done = this._done || e;\n  }\n}\nclass h extends i {\n  constructor() {\n    super(...arguments), this._loadStates = new Map();\n  }\n  destroy() {\n    super.destroy();\n    for (const t of this._loadStates.values()) t.destroy();\n    this._loadStates.clear();\n  }\n  get about() {\n    return {\n      supportsDisplayFilter: !0,\n      willQueryAllFeatures: !1,\n      willQueryFullResolutionGeometry: !1\n    };\n  }\n  async load(t) {\n    const o = e(this._loadStates, t.key.id, () => new l(t, this._options));\n    let r;\n    try {\n      await this._fetchPages(o);\n    } catch (h) {\n      r = h;\n    }\n    const i = new a(n.empty(this._metadata), null, t.tile, -1, !0);\n    if (s(o.options) || this._addChunk(i), r) throw r;\n  }\n  unload(t) {\n    super.unload(t), this._loadStates.get(t.key.id)?.destroy(), this._loadStates.delete(t.key.id);\n  }\n  async _fetchPages(t) {\n    const e = 4,\n      s = 20;\n    let r = 0,\n      i = t.pageStart,\n      a = 1;\n    for (; r < s && !t.done;) {\n      const s = [];\n      for (let e = 0; e < a; e++) s.push(this._fetchChunk(t, i++));\n      const n = await Promise.all(s);\n      for (const e of n) (0 !== e.size() || e.first) && (t.add(e.page, !e.reader.exceededTransferLimit), o(t.options), this._addChunk(e));\n      r++, a = Math.min(a + 1, e);\n    }\n  }\n  async _fetchChunk(t, e) {\n    const s = t.subscription.tile,\n      o = this._queryInfo.createPagedTileQuery(s, e),\n      r = await this._fetch(o, t.options, {\n        chunkId: `${s.id}-${e}`\n      });\n    return new a(r, o.inner.toJSON(), s, e, !1);\n  }\n}\nexport { h as PagedTileLoadStrategy };","map":{"version":3,"names":["handlesGroup","t","getOrCreateMapValue","e","isAborted","s","throwIfAborted","o","onAbort","r","ATileLoadStrategy","i","PagedTileSourceChunk","a","FeatureSetReaderJSON","n","l","constructor","subscription","_pages","Set","_controller","AbortController","_done","_handles","signal","abort","destroy","remove","pageStart","values","Math","max","done","options","add","h","arguments","_loadStates","Map","clear","about","supportsDisplayFilter","willQueryAllFeatures","willQueryFullResolutionGeometry","load","key","id","_options","_fetchPages","empty","_metadata","tile","_addChunk","unload","get","delete","push","_fetchChunk","Promise","all","size","first","page","reader","exceededTransferLimit","min","_queryInfo","createPagedTileQuery","_fetch","chunkId","inner","toJSON","PagedTileLoadStrategy"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/features/sources/strategies/PagedTileLoadStrategy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{handlesGroup as t}from\"../../../../../../core/handleUtils.js\";import{getOrCreateMapValue as e}from\"../../../../../../core/MapUtils.js\";import{isAborted as s,throwIfAborted as o,onAbort as r}from\"../../../../../../core/promiseUtils.js\";import{ATileLoadStrategy as i}from\"./ATileLoadStrategy.js\";import{PagedTileSourceChunk as a}from\"./chunks/PagedTileSourceChunk.js\";import{FeatureSetReaderJSON as n}from\"../../support/FeatureSetReaderJSON.js\";class l{constructor(e,s){this.subscription=e,this._pages=new Set,this._controller=new AbortController,this._done=!1,this._handles=t([r(e.signal,(()=>this._controller.abort())),r(s,(()=>this._controller.abort()))])}destroy(){this._controller.abort(),this._handles.remove()}get pageStart(){let t=-1;for(const e of this._pages.values())t=Math.max(t,e);return t+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(t,e){this._pages.add(t),this._done=this._done||e}}class h extends i{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const t of this._loadStates.values())t.destroy();this._loadStates.clear()}get about(){return{supportsDisplayFilter:!0,willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(t){const o=e(this._loadStates,t.key.id,(()=>new l(t,this._options)));let r;try{await this._fetchPages(o)}catch(h){r=h}const i=new a(n.empty(this._metadata),null,t.tile,-1,!0);if(s(o.options)||this._addChunk(i),r)throw r}unload(t){super.unload(t),this._loadStates.get(t.key.id)?.destroy(),this._loadStates.delete(t.key.id)}async _fetchPages(t){const e=4,s=20;let r=0,i=t.pageStart,a=1;for(;r<s&&!t.done;){const s=[];for(let e=0;e<a;e++)s.push(this._fetchChunk(t,i++));const n=await Promise.all(s);for(const e of n)(0!==e.size()||e.first)&&(t.add(e.page,!e.reader.exceededTransferLimit),o(t.options),this._addChunk(e));r++,a=Math.min(a+1,e)}}async _fetchChunk(t,e){const s=t.subscription.tile,o=this._queryInfo.createPagedTileQuery(s,e),r=await this._fetch(o,t.options,{chunkId:`${s.id}-${e}`});return new a(r,o.inner.toJSON(),s,e,!1)}}export{h as PagedTileLoadStrategy};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}