{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport { isSome as s } from \"../../../../core/arrayUtils.js\";\nimport has from \"../../../../core/has.js\";\nimport r from \"../../../../core/Identifiable.js\";\nimport { assertIsSome as i } from \"../../../../core/maybe.js\";\nimport { ignoreAbortErrors as o, throwIfAborted as a } from \"../../../../core/promiseUtils.js\";\nimport { watch as n } from \"../../../../core/reactiveUtils.js\";\nimport { property as h } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/Logger.js\";\nimport { subclass as d } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { create as c } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { isPolyline as l, isPolygon as p, isExtent as u, getJsonType as m } from \"../../../../geometry/support/jsonUtils.js\";\nimport g from \"../../../../layers/support/FieldsIndex.js\";\nimport { symbolToCIM as f, CIMSymbolHelper as y } from \"../../../../symbols/cim/CIMSymbolHelper.js\";\nimport { OverrideHelper as _ } from \"../../../../symbols/cim/OverrideHelper.js\";\nimport { errorPolylineSymbol2D as b, errorPolygonSymbol2D as w, errorPointSymbol2D as S } from \"../../../../symbols/support/defaults.js\";\nimport { filterFlag0 as I } from \"../../engine/webgl/definitions.js\";\nimport { FeatureTile as v } from \"../../engine/webgl/FeatureTile.js\";\nimport { MeshData as T } from \"../../engine/webgl/mesh/MeshData.js\";\nimport { ResourceProxy as M } from \"../../engine/webgl/mesh/factories/ResourceProxy.js\";\nimport { createGraphicSymbolMeshSchemas as R } from \"../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas.js\";\nimport { createStorageSchema as j } from \"../features/schema/processor/StorageSchema.js\";\nimport { AttributeStore as x } from \"../features/support/AttributeStore.js\";\nimport { ComputedAttributeStorage as U } from \"../features/support/ComputedAttributeStorage.js\";\nimport { GraphicsMetadata as C } from \"../features/support/FeatureMetadata.js\";\nimport { GraphicsReader as q } from \"../features/support/GraphicsReader.js\";\nimport G from \"./GraphicStore.js\";\nimport { FeatureCommandQueue as k } from \"../support/FeatureCommandQueue.js\";\nimport { UpdateTracking2D as P } from \"../support/UpdateTracking2D.js\";\nclass F {\n  static getOrCreate(e, t, s) {\n    let r = t.get(e.id);\n    return r || (r = new F(e, s), t.set(e.id, r)), r;\n  }\n  static fromItems(e, t, s) {\n    const r = new F(e, s);\n    for (const i of t) r.append(i);\n    return r;\n  }\n  constructor(e, t) {\n    this.tile = e, this.metadata = t, this.addedOrModified = [], this.removed = [], this.objectIdMap = null;\n  }\n  get reader() {\n    return this._reader || (this._reader = q.from(this.addedOrModified, this.tile, this.metadata)), this._reader;\n  }\n  append(e) {\n    this.addedOrModified.push(e), e.hasAnimations && (this.objectIdMap = this.objectIdMap || {}, this.objectIdMap[e.displayId] = e.objectId);\n  }\n}\nlet O = class extends r.IdentifiableMixin(t) {\n  constructor(e) {\n    super(e), this._attached = !1, this._tiles = new Map(), this._controller = new AbortController(), this._hashToSymbolInfo = new Map(), this._lastCleanup = performance.now(), this._cleanupRequired = !0, this.lastUpdateId = -1, this.renderer = null, this._updateTracking = new P({\n      debugName: \"GraphicsView2D\"\n    }), this.updateRequested = !1, this.defaultPointSymbolEnabled = !0, this._commandQueue = new k({\n      process: e => {\n        if (\"update\" === e.type) return this._update();\n        throw new Error(\"InternalError: Unsupported command\");\n      }\n    }), this.graphicUpdateHandler = this.graphicUpdateHandler.bind(this);\n  }\n  destroy() {\n    this.container.destroy(), this.view = null, this.renderer = null, this._set(\"graphics\", null), this._controller.abort(), this._graphicStore.clear(), this._graphicStore.destroy(), this._attributeStore = null, this._hashToSymbolInfo.clear(), this._updateTracking.destroy(), this._commandQueue.destroy();\n  }\n  _initAttributeStore() {\n    this._storage = new U({\n      spatialReference: this.view.spatialReference,\n      fields: new g()\n    }), this._attributeStore = new x({\n      isLocal: !0,\n      update: e => {\n        has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`, {\n          message: e\n        }), this.container.attributeView.requestUpdate(e), this.container.requestRender(), has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`, {\n          message: e\n        });\n      }\n    });\n    const e = j(null, []);\n    this._attributeStore.update(e, this._storage, null), this.container.checkHighlight = () => this._attributeStore.hasHighlight;\n  }\n  initialize() {\n    this._initAttributeStore(), this._metadata = C.createGraphics(this.view.spatialReference), this._resourceProxy = new M({\n      fetch: e => Promise.all(e.map(e => this.view.stage.textureManager.rasterizeItem(e))),\n      fetchDictionary: e => {\n        throw new Error(\"InternalError: Graphics do not support Dictionary requests\");\n      }\n    }), this.addHandles([n(() => this._effectiveRenderer, () => this._pushUpdate()), this.view.graphicsTileStore.on(\"update\", this._onTileUpdate.bind(this)), this.container.on(\"attach\", () => {\n      this.addHandles([this.graphics.on(\"change\", () => this._pushUpdate())]), this._graphicStore?.destroy(), this._graphicStore = new G(this.view.spatialReference, this._cimResourceManager, this.view.featuresTilingScheme, this.view.state.scale, this._attributeStore), this._attached = !0, this.requestUpdate(), this._pushUpdate();\n    })]), this._updateTracking.addUpdateTracking(\"CommandQueue\", this._commandQueue.updateTracking);\n    const e = this.view.graphicsTileStore.tiles;\n    this._onTileUpdate({\n      added: e,\n      removed: []\n    });\n  }\n  get _effectiveRenderer() {\n    return \"function\" == typeof this.renderer ? this.renderer() : this.renderer;\n  }\n  get _cimResourceManager() {\n    return this.view.stage.textureManager.resourceManager;\n  }\n  get updating() {\n    const e = !this._attached || this._updateTracking.updating;\n    return has(\"esri-2d-log-updating\") && console.log(`Updating GraphicsView2D: ${e}\\n  -> attaching ${!this._attached}\\n  -> updateTracking ${this._updateTracking.updating}`), e;\n  }\n  hitTest(e) {\n    if (!this.view || this.view.suspended) return [];\n    const {\n        resolution: t,\n        rotation: r\n      } = this.view.state,\n      i = this._graphicStore.hitTest(e.x, e.y, 2, t, r),\n      o = new Set(i),\n      a = this.graphics.items.reduce((e, t) => (o.has(t.uid) && e.set(t.uid, t), e), new Map());\n    return i.map(e => a.get(e)).filter(s);\n  }\n  requestUpdate() {\n    this.updateRequested || (this.updateRequested = !0, this.requestUpdateCallback()), this.notifyChange(\"updating\");\n  }\n  processUpdate(e) {\n    this.updateRequested && (this.updateRequested = !1, this.update(e));\n  }\n  viewChange() {\n    this.requestUpdate();\n  }\n  setHighlight(e) {\n    const t = [];\n    for (const {\n      objectId: s,\n      highlightFlags: r\n    } of e) {\n      const e = this._graphicStore.getItem(s)?.displayId;\n      t.push({\n        objectId: s,\n        highlightFlags: r,\n        displayId: e\n      });\n    }\n    this._attributeStore.setHighlight(t, e), this._pushUpdate();\n  }\n  graphicUpdateHandler(e) {\n    this._pushUpdate();\n  }\n  update(e) {\n    this.updateRequested = !1, this._attached && this._graphicStore.updateLevel(e.state.resolution) && this.pushUpdate();\n  }\n  pushUpdate() {\n    this._pushUpdate();\n  }\n  _pushUpdate() {\n    o(this._commandQueue.push({\n      type: \"update\"\n    }));\n  }\n  async _update() {\n    try {\n      has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);\n      const e = await this._graphicStore.update(this.graphics, e => this._getSymbolForGraphic(e), e => this._ensureSymbolResource(e));\n      for (const s of e.updated) this.container.restartAnimation(s.objectId);\n      if (!e.hasAnyUpdate()) return void this._attributeStore.sendUpdates();\n      e.removed.length && (this._cleanupRequired = !0), has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`, e);\n      const t = this._createTileMessages(e);\n      await this._densifyItemsForDisplay(t), await this._fetchResources(t), this._write(t);\n      for (const s of e.added) this._setFilterState(s);\n      for (const s of e.updated) this._setFilterState(s);\n      has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`, e), this._attributeStore.sendUpdates(), has(\"esri-2d-update-debug\") && console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`, e);\n    } catch (e) {}\n    this._cleanupSharedResources();\n  }\n  _createTileMessages(e) {\n    const t = new Map();\n    for (const s of e.added) {\n      const e = this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);\n      for (const r of e) {\n        F.getOrCreate(r, t, this._metadata).append(s);\n      }\n    }\n    for (const s of e.updated) {\n      const e = this.view.graphicsTileStore.getIntersectingTiles(s.prevSymbolBounds),\n        r = this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);\n      for (const i of e) {\n        F.getOrCreate(i, t, this._metadata).removed.push(s.displayId);\n      }\n      for (const i of r) {\n        F.getOrCreate(i, t, this._metadata).append(s);\n      }\n    }\n    for (const s of e.removed) {\n      const e = this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);\n      for (const r of e) {\n        F.getOrCreate(r, t, this._metadata).removed.push(s.displayId);\n      }\n    }\n    return Array.from(t.values());\n  }\n  async _densifyItemsForDisplay(e) {\n    const t = new Map();\n    for (const s of e) for (const e of s.addedOrModified) t.has(e) || t.set(e, e.densifyCurvedGeometryForDisplay(this.view.spatialReference));\n    await Promise.all(t.values());\n  }\n  async _fetchResources(e) {\n    const t = {\n      timeZone: null,\n      timeExtent: null\n    };\n    for (const {\n      tile: s,\n      reader: r\n    } of e) {\n      has(\"esri-2d-update-debug\") && console.debug(`Id[${this.layerId}] Tile[${s.id}] GraphicsView fetchResources`, e);\n      const i = r.getCursor();\n      for (; i.next();) for (const e of i.getMeshWriters()) e.enqueueRequest(this._resourceProxy, i, s.createArcadeEvaluationOptions(t));\n    }\n    await this._resourceProxy.fetchEnqueuedResources();\n  }\n  _write(e) {\n    for (const t of e) {\n      has(\"esri-2d-update-debug\") && console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView write`, t);\n      const e = this._writeMeshes(t);\n      let s = this._tiles.get(t.tile.key);\n      s || (s = this._createFeatureTile(t.tile.key)), has(\"esri-2d-update-debug\") && console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView onTileData`, t), this.container.onTileData(s, {\n        type: \"update\",\n        modify: e,\n        remove: t.removed,\n        end: !1,\n        attributeEpoch: this._attributeStore.epoch,\n        objectIdMap: t.objectIdMap\n      }), this.container.requestRender();\n    }\n  }\n  _writeMeshes(e) {\n    const t = {\n        timeZone: null,\n        timeExtent: null\n      },\n      s = new T(e.tile.id),\n      r = e.reader.getCursor();\n    for (; r.next();) {\n      s.entityStart(r.getDisplayId(), r.getZOrder());\n      for (const i of r.getMeshWriters()) i.write(s, this._resourceProxy, r, e.tile.createArcadeEvaluationOptions(t), e.tile.level);\n      s.entityEnd();\n    }\n    return {\n      ...s.serialize().message,\n      tileId: e.tile.id\n    };\n  }\n  _setFilterState(e) {\n    const t = e.displayId,\n      s = this._attributeStore.getHighlightFlags(e.objectId);\n    this._attributeStore.setData(t, 0, 0, s | (e.visible ? I : 0));\n  }\n  _getSymbolForGraphic(e) {\n    return null != e.symbol ? e.symbol : null != this._effectiveRenderer ? this._effectiveRenderer.getSymbol(e) : this._getNullSymbol(e);\n  }\n  async _ensureSymbolResource(e) {\n    if (!e.symbol) return;\n    const t = await this._getSymbolInfo(e.symbol);\n    if (!t) return;\n    const s = t.linearCIM.filter(e => \"text\" === e.type);\n    if (s.length > 0) {\n      const r = await this._getTextResources(e, s);\n      e.symbolResource = {\n        symbolInfo: t,\n        textInfo: r\n      };\n    } else e.symbolResource = {\n      symbolInfo: t\n    };\n  }\n  _getSymbolInfo(e) {\n    const t = e.hash();\n    return this._hashToSymbolInfo.has(t) || this._hashToSymbolInfo.set(t, this._createSymbolInfo(t, e).catch(e => null)), this._hashToSymbolInfo.get(t);\n  }\n  async _createSymbolInfo(e, t) {\n    const s = await this._convertToCIMSymbol(t),\n      r = await this._createLinearCIM(s);\n    return {\n      hash: e,\n      cimSymbol: s,\n      linearCIM: r,\n      meshWriters: await this._createMeshWriters(s, r)\n    };\n  }\n  async _convertToCIMSymbol(e) {\n    const t = f(e);\n    if (\"web-style\" === t.type) {\n      return (await t.fetchCIMSymbol()).data;\n    }\n    return t;\n  }\n  async _createLinearCIM(e) {\n    return await Promise.all(y.fetchResources(e.symbol, this._cimResourceManager, [])), this.view.stage.cimAnalyzer.analyzeSymbolReference(e, !1);\n  }\n  async _createMeshWriters(e, t) {\n    a(this._controller.signal);\n    const s = this.container.instanceStore,\n      r = this.view.stage.meshWriterRegistry,\n      i = await R(e, t, s);\n    return Promise.all(i.map(e => r.createMeshWriter(this._storage, this._resourceProxy, {\n      tileInfo: this.view.featuresTilingScheme.tileInfo\n    }, e)));\n  }\n  _onTileUpdate(e) {\n    if (e.added && e.added.length > 0) for (const t of e.added) this._updateTracking.addPromise(this._addTile(t));\n    if (e.removed && e.removed.length > 0) for (const t of e.removed) this._removeTile(t.key);\n  }\n  _createFeatureTile(e) {\n    const t = this.view.featuresTilingScheme.getTileBounds(c(), e),\n      s = this.view.featuresTilingScheme.getTileResolution(e.level),\n      r = new v(e, s, t[0], t[3]);\n    return this._tiles.set(e, r), this.container.addChild(r), r;\n  }\n  async _addTile(e) {\n    if (!this._attached) return;\n    const t = this._graphicStore.queryItems(e);\n    if (!t.length) return;\n    const s = this._createFeatureTile(e.key),\n      r = F.fromItems(e, t, this._metadata);\n    await this._densifyItemsForDisplay([r]), await this._fetchResources([r]);\n    const i = this._writeMeshes(r);\n    s.onMessage({\n      type: \"append\",\n      append: i,\n      clear: !1,\n      end: !0,\n      attributeEpoch: this._attributeStore.epoch,\n      objectIdMap: r.objectIdMap\n    });\n  }\n  _removeTile(e) {\n    if (!this._tiles.has(e)) return;\n    const t = this._tiles.get(e);\n    this.container.removeChild(t), t.destroy(), this._tiles.delete(e);\n  }\n  _getNullSymbol(e) {\n    const t = e.geometry;\n    return l(t) ? b : p(t) || u(t) ? w : this.defaultPointSymbolEnabled ? S : null;\n  }\n  async _getTextResources(e, t) {\n    const s = new Array(),\n      r = new Array();\n    for (let i = 0; i < t.length; i++) {\n      const o = t[i],\n        {\n          resource: a,\n          overrides: n\n        } = o.textRasterizationParam;\n      if (n?.length > 0) {\n        const t = _.resolveSymbolOverrides({\n          type: \"CIMSymbolReference\",\n          primitiveOverrides: n,\n          symbol: {\n            type: \"CIMPointSymbol\",\n            symbolLayers: [{\n              type: \"CIMVectorMarker\",\n              enable: !0,\n              size: a.symbol.height,\n              anchorPointUnits: \"Relative\",\n              frame: {\n                xmin: -5,\n                ymin: -5,\n                xmax: 5,\n                ymax: 5\n              },\n              markerGraphics: [{\n                type: \"CIMMarkerGraphic\",\n                geometry: {\n                  x: 0,\n                  y: 0\n                },\n                symbol: a.symbol,\n                textString: a.textString\n              }],\n              scaleSymbolsProportionally: !0,\n              respectFrame: !0\n            }]\n          }\n        }, e, this.view.spatialReference, null, m(e.projectedGeometry), null, null);\n        t.then(e => {\n          const t = e.symbolLayers[0],\n            {\n              textString: s\n            } = t.markerGraphics[0];\n          r.push({\n            type: \"cim-rasterization-info\",\n            resource: {\n              type: \"text\",\n              textString: s || \"\",\n              font: a.font\n            }\n          }), o.text = a.textString = s || \"\";\n        }), s.push(t);\n      } else r.push({\n        type: \"cim-rasterization-info\",\n        resource: a\n      });\n    }\n    s.length > 0 && (await Promise.all(s));\n    const o = r.map(e => this.view.stage.textureManager.rasterizeItem(e)),\n      a = await Promise.all(o);\n    i(a);\n    const n = new Map();\n    for (let i = 0; i < t.length; i++) {\n      const e = t[i];\n      n.set(e.textRasterizationParam.resource.symbol, {\n        text: e.text,\n        glyphMosaicItems: a[i]\n      });\n    }\n    return n;\n  }\n  _cleanupSharedResources() {\n    if (!this._cleanupRequired) return;\n    const e = performance.now();\n    if (e - this._lastCleanup < 5e3) return;\n    this._cleanupRequired = !1, this._lastCleanup = e;\n    const t = new Set();\n    for (const r of this._graphicStore.items()) {\n      const e = r.symbolResource?.symbolInfo.hash;\n      t.add(e);\n    }\n    const s = new Set(this._hashToSymbolInfo.keys());\n    for (const r of s.values()) t.has(r) || this._hashToSymbolInfo.delete(r);\n  }\n};\ne([h()], O.prototype, \"_effectiveRenderer\", null), e([h({\n  constructOnly: !0\n})], O.prototype, \"layerId\", void 0), e([h({\n  constructOnly: !0\n})], O.prototype, \"requestUpdateCallback\", void 0), e([h()], O.prototype, \"container\", void 0), e([h({\n  constructOnly: !0\n})], O.prototype, \"graphics\", void 0), e([h()], O.prototype, \"renderer\", void 0), e([h()], O.prototype, \"_updateTracking\", void 0), e([h()], O.prototype, \"updating\", null), e([h()], O.prototype, \"view\", void 0), e([h()], O.prototype, \"updateRequested\", void 0), e([h()], O.prototype, \"defaultPointSymbolEnabled\", void 0), O = e([d(\"esri.views.2d.layers.graphics.GraphicsView2D\")], O);\nconst A = O;\nexport { A as default };","map":{"version":3,"names":["_","e","t","isSome","s","has","r","assertIsSome","i","ignoreAbortErrors","o","throwIfAborted","a","watch","n","property","h","subclass","d","create","c","isPolyline","l","isPolygon","p","isExtent","u","getJsonType","m","g","symbolToCIM","f","CIMSymbolHelper","y","OverrideHelper","errorPolylineSymbol2D","b","errorPolygonSymbol2D","w","errorPointSymbol2D","S","filterFlag0","I","FeatureTile","v","MeshData","T","ResourceProxy","M","createGraphicSymbolMeshSchemas","R","createStorageSchema","j","AttributeStore","x","ComputedAttributeStorage","U","GraphicsMetadata","C","GraphicsReader","q","G","FeatureCommandQueue","k","UpdateTracking2D","P","F","getOrCreate","get","id","set","fromItems","append","constructor","tile","metadata","addedOrModified","removed","objectIdMap","reader","_reader","from","push","hasAnimations","displayId","objectId","O","IdentifiableMixin","_attached","_tiles","Map","_controller","AbortController","_hashToSymbolInfo","_lastCleanup","performance","now","_cleanupRequired","lastUpdateId","renderer","_updateTracking","debugName","updateRequested","defaultPointSymbolEnabled","_commandQueue","process","type","_update","Error","graphicUpdateHandler","bind","destroy","container","view","_set","abort","_graphicStore","clear","_attributeStore","_initAttributeStore","_storage","spatialReference","fields","isLocal","update","console","debug","layerId","message","attributeView","requestUpdate","requestRender","checkHighlight","hasHighlight","initialize","_metadata","createGraphics","_resourceProxy","fetch","Promise","all","map","stage","textureManager","rasterizeItem","fetchDictionary","addHandles","_effectiveRenderer","_pushUpdate","graphicsTileStore","on","_onTileUpdate","graphics","_cimResourceManager","featuresTilingScheme","state","scale","addUpdateTracking","updateTracking","tiles","added","resourceManager","updating","log","hitTest","suspended","resolution","rotation","Set","items","reduce","uid","filter","requestUpdateCallback","notifyChange","processUpdate","viewChange","setHighlight","highlightFlags","getItem","updateLevel","pushUpdate","_getSymbolForGraphic","_ensureSymbolResource","updated","restartAnimation","hasAnyUpdate","sendUpdates","length","_createTileMessages","_densifyItemsForDisplay","_fetchResources","_write","_setFilterState","_cleanupSharedResources","getIntersectingTiles","symbolBounds","prevSymbolBounds","Array","values","densifyCurvedGeometryForDisplay","timeZone","timeExtent","getCursor","next","getMeshWriters","enqueueRequest","createArcadeEvaluationOptions","fetchEnqueuedResources","_writeMeshes","key","_createFeatureTile","onTileData","modify","remove","end","attributeEpoch","epoch","entityStart","getDisplayId","getZOrder","write","level","entityEnd","serialize","tileId","getHighlightFlags","setData","visible","symbol","getSymbol","_getNullSymbol","_getSymbolInfo","linearCIM","_getTextResources","symbolResource","symbolInfo","textInfo","hash","_createSymbolInfo","catch","_convertToCIMSymbol","_createLinearCIM","cimSymbol","meshWriters","_createMeshWriters","fetchCIMSymbol","data","fetchResources","cimAnalyzer","analyzeSymbolReference","signal","instanceStore","meshWriterRegistry","createMeshWriter","tileInfo","addPromise","_addTile","_removeTile","getTileBounds","getTileResolution","addChild","queryItems","onMessage","removeChild","delete","geometry","resource","overrides","textRasterizationParam","resolveSymbolOverrides","primitiveOverrides","symbolLayers","enable","size","height","anchorPointUnits","frame","xmin","ymin","xmax","ymax","markerGraphics","textString","scaleSymbolsProportionally","respectFrame","projectedGeometry","then","font","text","glyphMosaicItems","add","keys","prototype","constructOnly","A","default"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{isSome as s}from\"../../../../core/arrayUtils.js\";import has from\"../../../../core/has.js\";import r from\"../../../../core/Identifiable.js\";import{assertIsSome as i}from\"../../../../core/maybe.js\";import{ignoreAbortErrors as o,throwIfAborted as a}from\"../../../../core/promiseUtils.js\";import{watch as n}from\"../../../../core/reactiveUtils.js\";import{property as h}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/Logger.js\";import{subclass as d}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{create as c}from\"../../../../geometry/support/aaBoundingRect.js\";import{isPolyline as l,isPolygon as p,isExtent as u,getJsonType as m}from\"../../../../geometry/support/jsonUtils.js\";import g from\"../../../../layers/support/FieldsIndex.js\";import{symbolToCIM as f,CIMSymbolHelper as y}from\"../../../../symbols/cim/CIMSymbolHelper.js\";import{OverrideHelper as _}from\"../../../../symbols/cim/OverrideHelper.js\";import{errorPolylineSymbol2D as b,errorPolygonSymbol2D as w,errorPointSymbol2D as S}from\"../../../../symbols/support/defaults.js\";import{filterFlag0 as I}from\"../../engine/webgl/definitions.js\";import{FeatureTile as v}from\"../../engine/webgl/FeatureTile.js\";import{MeshData as T}from\"../../engine/webgl/mesh/MeshData.js\";import{ResourceProxy as M}from\"../../engine/webgl/mesh/factories/ResourceProxy.js\";import{createGraphicSymbolMeshSchemas as R}from\"../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas.js\";import{createStorageSchema as j}from\"../features/schema/processor/StorageSchema.js\";import{AttributeStore as x}from\"../features/support/AttributeStore.js\";import{ComputedAttributeStorage as U}from\"../features/support/ComputedAttributeStorage.js\";import{GraphicsMetadata as C}from\"../features/support/FeatureMetadata.js\";import{GraphicsReader as q}from\"../features/support/GraphicsReader.js\";import G from\"./GraphicStore.js\";import{FeatureCommandQueue as k}from\"../support/FeatureCommandQueue.js\";import{UpdateTracking2D as P}from\"../support/UpdateTracking2D.js\";class F{static getOrCreate(e,t,s){let r=t.get(e.id);return r||(r=new F(e,s),t.set(e.id,r)),r}static fromItems(e,t,s){const r=new F(e,s);for(const i of t)r.append(i);return r}constructor(e,t){this.tile=e,this.metadata=t,this.addedOrModified=[],this.removed=[],this.objectIdMap=null}get reader(){return this._reader||(this._reader=q.from(this.addedOrModified,this.tile,this.metadata)),this._reader}append(e){this.addedOrModified.push(e),e.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[e.displayId]=e.objectId)}}let O=class extends(r.IdentifiableMixin(t)){constructor(e){super(e),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new P({debugName:\"GraphicsView2D\"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new k({process:e=>{if(\"update\"===e.type)return this._update();throw new Error(\"InternalError: Unsupported command\")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set(\"graphics\",null),this._controller.abort(),this._graphicStore.clear(),this._graphicStore.destroy(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new U({spatialReference:this.view.spatialReference,fields:new g}),this._attributeStore=new x({isLocal:!0,update:e=>{has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:e}),this.container.attributeView.requestUpdate(e),this.container.requestRender(),has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:e})}});const e=j(null,[]);this._attributeStore.update(e,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=C.createGraphics(this.view.spatialReference),this._resourceProxy=new M({fetch:e=>Promise.all(e.map((e=>this.view.stage.textureManager.rasterizeItem(e)))),fetchDictionary:e=>{throw new Error(\"InternalError: Graphics do not support Dictionary requests\")}}),this.addHandles([n((()=>this._effectiveRenderer),(()=>this._pushUpdate())),this.view.graphicsTileStore.on(\"update\",this._onTileUpdate.bind(this)),this.container.on(\"attach\",(()=>{this.addHandles([this.graphics.on(\"change\",(()=>this._pushUpdate()))]),this._graphicStore?.destroy(),this._graphicStore=new G(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()}))]),this._updateTracking.addUpdateTracking(\"CommandQueue\",this._commandQueue.updateTracking);const e=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:e,removed:[]})}get _effectiveRenderer(){return\"function\"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const e=!this._attached||this._updateTracking.updating;return has(\"esri-2d-log-updating\")&&console.log(`Updating GraphicsView2D: ${e}\\n  -> attaching ${!this._attached}\\n  -> updateTracking ${this._updateTracking.updating}`),e}hitTest(e){if(!this.view||this.view.suspended)return[];const{resolution:t,rotation:r}=this.view.state,i=this._graphicStore.hitTest(e.x,e.y,2,t,r),o=new Set(i),a=this.graphics.items.reduce(((e,t)=>(o.has(t.uid)&&e.set(t.uid,t),e)),new Map);return i.map((e=>a.get(e))).filter(s)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange(\"updating\")}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}viewChange(){this.requestUpdate()}setHighlight(e){const t=[];for(const{objectId:s,highlightFlags:r}of e){const e=this._graphicStore.getItem(s)?.displayId;t.push({objectId:s,highlightFlags:r,displayId:e})}this._attributeStore.setHighlight(t,e),this._pushUpdate()}graphicUpdateHandler(e){this._pushUpdate()}update(e){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(e.state.resolution)&&this.pushUpdate()}pushUpdate(){this._pushUpdate()}_pushUpdate(){o(this._commandQueue.push({type:\"update\"}))}async _update(){try{has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const e=await this._graphicStore.update(this.graphics,(e=>this._getSymbolForGraphic(e)),(e=>this._ensureSymbolResource(e)));for(const s of e.updated)this.container.restartAnimation(s.objectId);if(!e.hasAnyUpdate())return void this._attributeStore.sendUpdates();e.removed.length&&(this._cleanupRequired=!0),has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,e);const t=this._createTileMessages(e);await this._densifyItemsForDisplay(t),await this._fetchResources(t),this._write(t);for(const s of e.added)this._setFilterState(s);for(const s of e.updated)this._setFilterState(s);has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,e),this._attributeStore.sendUpdates(),has(\"esri-2d-update-debug\")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,e)}catch(e){}this._cleanupSharedResources()}_createTileMessages(e){const t=new Map;for(const s of e.added){const e=this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);for(const r of e){F.getOrCreate(r,t,this._metadata).append(s)}}for(const s of e.updated){const e=this.view.graphicsTileStore.getIntersectingTiles(s.prevSymbolBounds),r=this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);for(const i of e){F.getOrCreate(i,t,this._metadata).removed.push(s.displayId)}for(const i of r){F.getOrCreate(i,t,this._metadata).append(s)}}for(const s of e.removed){const e=this.view.graphicsTileStore.getIntersectingTiles(s.symbolBounds);for(const r of e){F.getOrCreate(r,t,this._metadata).removed.push(s.displayId)}}return Array.from(t.values())}async _densifyItemsForDisplay(e){const t=new Map;for(const s of e)for(const e of s.addedOrModified)t.has(e)||t.set(e,e.densifyCurvedGeometryForDisplay(this.view.spatialReference));await Promise.all(t.values())}async _fetchResources(e){const t={timeZone:null,timeExtent:null};for(const{tile:s,reader:r}of e){has(\"esri-2d-update-debug\")&&console.debug(`Id[${this.layerId}] Tile[${s.id}] GraphicsView fetchResources`,e);const i=r.getCursor();for(;i.next();)for(const e of i.getMeshWriters())e.enqueueRequest(this._resourceProxy,i,s.createArcadeEvaluationOptions(t))}await this._resourceProxy.fetchEnqueuedResources()}_write(e){for(const t of e){has(\"esri-2d-update-debug\")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView write`,t);const e=this._writeMeshes(t);let s=this._tiles.get(t.tile.key);s||(s=this._createFeatureTile(t.tile.key)),has(\"esri-2d-update-debug\")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView onTileData`,t),this.container.onTileData(s,{type:\"update\",modify:e,remove:t.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:t.objectIdMap}),this.container.requestRender()}}_writeMeshes(e){const t={timeZone:null,timeExtent:null},s=new T(e.tile.id),r=e.reader.getCursor();for(;r.next();){s.entityStart(r.getDisplayId(),r.getZOrder());for(const i of r.getMeshWriters())i.write(s,this._resourceProxy,r,e.tile.createArcadeEvaluationOptions(t),e.tile.level);s.entityEnd()}return{...s.serialize().message,tileId:e.tile.id}}_setFilterState(e){const t=e.displayId,s=this._attributeStore.getHighlightFlags(e.objectId);this._attributeStore.setData(t,0,0,s|(e.visible?I:0))}_getSymbolForGraphic(e){return null!=e.symbol?e.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(e):this._getNullSymbol(e)}async _ensureSymbolResource(e){if(!e.symbol)return;const t=await this._getSymbolInfo(e.symbol);if(!t)return;const s=t.linearCIM.filter((e=>\"text\"===e.type));if(s.length>0){const r=await this._getTextResources(e,s);e.symbolResource={symbolInfo:t,textInfo:r}}else e.symbolResource={symbolInfo:t}}_getSymbolInfo(e){const t=e.hash();return this._hashToSymbolInfo.has(t)||this._hashToSymbolInfo.set(t,this._createSymbolInfo(t,e).catch((e=>null))),this._hashToSymbolInfo.get(t)}async _createSymbolInfo(e,t){const s=await this._convertToCIMSymbol(t),r=await this._createLinearCIM(s);return{hash:e,cimSymbol:s,linearCIM:r,meshWriters:await this._createMeshWriters(s,r)}}async _convertToCIMSymbol(e){const t=f(e);if(\"web-style\"===t.type){return(await t.fetchCIMSymbol()).data}return t}async _createLinearCIM(e){return await Promise.all(y.fetchResources(e.symbol,this._cimResourceManager,[])),this.view.stage.cimAnalyzer.analyzeSymbolReference(e,!1)}async _createMeshWriters(e,t){a(this._controller.signal);const s=this.container.instanceStore,r=this.view.stage.meshWriterRegistry,i=await R(e,t,s);return Promise.all(i.map((e=>r.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},e))))}_onTileUpdate(e){if(e.added&&e.added.length>0)for(const t of e.added)this._updateTracking.addPromise(this._addTile(t));if(e.removed&&e.removed.length>0)for(const t of e.removed)this._removeTile(t.key)}_createFeatureTile(e){const t=this.view.featuresTilingScheme.getTileBounds(c(),e),s=this.view.featuresTilingScheme.getTileResolution(e.level),r=new v(e,s,t[0],t[3]);return this._tiles.set(e,r),this.container.addChild(r),r}async _addTile(e){if(!this._attached)return;const t=this._graphicStore.queryItems(e);if(!t.length)return;const s=this._createFeatureTile(e.key),r=F.fromItems(e,t,this._metadata);await this._densifyItemsForDisplay([r]),await this._fetchResources([r]);const i=this._writeMeshes(r);s.onMessage({type:\"append\",append:i,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:r.objectIdMap})}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_getNullSymbol(e){const t=e.geometry;return l(t)?b:p(t)||u(t)?w:this.defaultPointSymbolEnabled?S:null}async _getTextResources(e,t){const s=new Array,r=new Array;for(let i=0;i<t.length;i++){const o=t[i],{resource:a,overrides:n}=o.textRasterizationParam;if(n?.length>0){const t=_.resolveSymbolOverrides({type:\"CIMSymbolReference\",primitiveOverrides:n,symbol:{type:\"CIMPointSymbol\",symbolLayers:[{type:\"CIMVectorMarker\",enable:!0,size:a.symbol.height,anchorPointUnits:\"Relative\",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:\"CIMMarkerGraphic\",geometry:{x:0,y:0},symbol:a.symbol,textString:a.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},e,this.view.spatialReference,null,m(e.projectedGeometry),null,null);t.then((e=>{const t=e.symbolLayers[0],{textString:s}=t.markerGraphics[0];r.push({type:\"cim-rasterization-info\",resource:{type:\"text\",textString:s||\"\",font:a.font}}),o.text=a.textString=s||\"\"})),s.push(t)}else r.push({type:\"cim-rasterization-info\",resource:a})}s.length>0&&await Promise.all(s);const o=r.map((e=>this.view.stage.textureManager.rasterizeItem(e))),a=await Promise.all(o);i(a);const n=new Map;for(let i=0;i<t.length;i++){const e=t[i];n.set(e.textRasterizationParam.resource.symbol,{text:e.text,glyphMosaicItems:a[i]})}return n}_cleanupSharedResources(){if(!this._cleanupRequired)return;const e=performance.now();if(e-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=e;const t=new Set;for(const r of this._graphicStore.items()){const e=r.symbolResource?.symbolInfo.hash;t.add(e)}const s=new Set(this._hashToSymbolInfo.keys());for(const r of s.values())t.has(r)||this._hashToSymbolInfo.delete(r)}};e([h()],O.prototype,\"_effectiveRenderer\",null),e([h({constructOnly:!0})],O.prototype,\"layerId\",void 0),e([h({constructOnly:!0})],O.prototype,\"requestUpdateCallback\",void 0),e([h()],O.prototype,\"container\",void 0),e([h({constructOnly:!0})],O.prototype,\"graphics\",void 0),e([h()],O.prototype,\"renderer\",void 0),e([h()],O.prototype,\"_updateTracking\",void 0),e([h()],O.prototype,\"updating\",null),e([h()],O.prototype,\"view\",void 0),e([h()],O.prototype,\"updateRequested\",void 0),e([h()],O.prototype,\"defaultPointSymbolEnabled\",void 0),O=e([d(\"esri.views.2d.layers.graphics.GraphicsView2D\")],O);const A=O;export{A as default};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}