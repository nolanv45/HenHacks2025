{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { id as e } from \"../../kernel.js\";\nimport r from \"../../request.js\";\nimport t from \"../../core/Error.js\";\nimport { throwIfAbortError as n } from \"../../core/promiseUtils.js\";\nimport { parse as a } from \"./arcgisLayerUrl.js\";\nimport o from \"../../portal/Portal.js\";\nimport i from \"../../portal/PortalItem.js\";\nasync function s(e, r) {\n  const n = a(e);\n  if (!n) throw new t(\"invalid-url\", \"Invalid scene service url\");\n  const o = {\n    ...r,\n    sceneServerUrl: n.url.path,\n    layerId: n.sublayer ?? void 0\n  };\n  if (o.sceneLayerItem ??= await l(o), null == o.sceneLayerItem) return f(o.sceneServerUrl.replace(\"/SceneServer\", \"/FeatureServer\"), o);\n  const i = await y(o);\n  if (!i?.url) throw new t(\"related-service-not-found\", \"Could not find feature service through portal item relationship\");\n  o.featureServiceItem = i;\n  const s = await f(i.url, o);\n  return s.portalItem = i, s;\n}\nasync function l(e) {\n  const r = (await c(e)).serviceItemId;\n  if (!r) return null;\n  const t = new i({\n      id: r,\n      apiKey: e.apiKey\n    }),\n    a = await u(e);\n  null != a && (t.portal = new o({\n    url: a\n  }));\n  try {\n    return await t.load({\n      signal: e.signal\n    });\n  } catch (s) {\n    return n(s), null;\n  }\n}\nasync function c(e) {\n  if (e.rootDocument) return e.rootDocument;\n  const t = {\n    query: {\n      f: \"json\",\n      ...e.customParameters,\n      token: e.apiKey\n    },\n    responseType: \"json\",\n    signal: e.signal\n  };\n  try {\n    const n = await r(e.sceneServerUrl, t);\n    e.rootDocument = n.data;\n  } catch {\n    e.rootDocument = {};\n  }\n  return e.rootDocument;\n}\nasync function u(t) {\n  const a = e?.findServerInfo(t.sceneServerUrl);\n  if (a?.owningSystemUrl) return a.owningSystemUrl;\n  const o = t.sceneServerUrl.replace(/(.*\\/rest)\\/.*/i, \"$1\") + \"/info\";\n  try {\n    const e = (await r(o, {\n      query: {\n        f: \"json\"\n      },\n      responseType: \"json\",\n      signal: t.signal\n    })).data.owningSystemUrl;\n    if (e) return e;\n  } catch (i) {\n    n(i);\n  }\n  return null;\n}\nasync function f(e, n) {\n  const o = a(e);\n  if (!o) throw new t(\"invalid-feature-service-url\", \"Invalid feature service url\");\n  const i = o.url.path,\n    s = n.layerId;\n  if (null == s) return {\n    serverUrl: i\n  };\n  const l = c(n),\n    u = n.featureServiceItem ? await n.featureServiceItem.fetchData(\"json\") : null,\n    f = (u?.layers?.[0] || u?.tables?.[0])?.customParameters,\n    y = e => {\n      const t = {\n        query: {\n          f: \"json\",\n          ...f\n        },\n        responseType: \"json\",\n        authMode: e,\n        signal: n.signal\n      };\n      return r(i, t);\n    },\n    m = y(\"anonymous\").catch(() => y(\"no-prompt\")),\n    [p, d] = await Promise.all([m, l]),\n    v = d?.layers,\n    w = p.data && p.data.layers;\n  if (!Array.isArray(w)) throw new Error(\"expected layers array\");\n  if (Array.isArray(v)) for (let r = 0; r < Math.min(v.length, w.length); r++) {\n    if (v[r].id === s) return {\n      serverUrl: i,\n      layerId: w[r].id\n    };\n  } else if (null != s && s < w.length) return {\n    serverUrl: i,\n    layerId: w[s].id\n  };\n  throw new Error(\"could not find matching associated sublayer\");\n}\nasync function y({\n  sceneLayerItem: e,\n  signal: r\n}) {\n  if (!e) return null;\n  try {\n    const t = (await e.fetchRelatedItems({\n      relationshipType: \"Service2Service\",\n      direction: \"reverse\"\n    }, {\n      signal: r\n    })).find(e => \"Feature Service\" === e.type) || null;\n    if (!t) return null;\n    const n = new i({\n      portal: t.portal,\n      id: t.id\n    });\n    return await n.load(), n;\n  } catch (t) {\n    return n(t), null;\n  }\n}\nexport { s as findAssociatedFeatureService };","map":{"version":3,"names":["id","e","r","t","throwIfAbortError","n","parse","a","o","i","s","sceneServerUrl","url","path","layerId","sublayer","sceneLayerItem","l","f","replace","y","featureServiceItem","portalItem","c","serviceItemId","apiKey","u","portal","load","signal","rootDocument","query","customParameters","token","responseType","data","findServerInfo","owningSystemUrl","serverUrl","fetchData","layers","tables","authMode","m","catch","p","d","Promise","all","v","w","Array","isArray","Error","Math","min","length","fetchRelatedItems","relationshipType","direction","find","type","findAssociatedFeatureService"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/layers/support/associatedFeatureServiceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{id as e}from\"../../kernel.js\";import r from\"../../request.js\";import t from\"../../core/Error.js\";import{throwIfAbortError as n}from\"../../core/promiseUtils.js\";import{parse as a}from\"./arcgisLayerUrl.js\";import o from\"../../portal/Portal.js\";import i from\"../../portal/PortalItem.js\";async function s(e,r){const n=a(e);if(!n)throw new t(\"invalid-url\",\"Invalid scene service url\");const o={...r,sceneServerUrl:n.url.path,layerId:n.sublayer??void 0};if(o.sceneLayerItem??=await l(o),null==o.sceneLayerItem)return f(o.sceneServerUrl.replace(\"/SceneServer\",\"/FeatureServer\"),o);const i=await y(o);if(!i?.url)throw new t(\"related-service-not-found\",\"Could not find feature service through portal item relationship\");o.featureServiceItem=i;const s=await f(i.url,o);return s.portalItem=i,s}async function l(e){const r=(await c(e)).serviceItemId;if(!r)return null;const t=new i({id:r,apiKey:e.apiKey}),a=await u(e);null!=a&&(t.portal=new o({url:a}));try{return await t.load({signal:e.signal})}catch(s){return n(s),null}}async function c(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:\"json\",...e.customParameters,token:e.apiKey},responseType:\"json\",signal:e.signal};try{const n=await r(e.sceneServerUrl,t);e.rootDocument=n.data}catch{e.rootDocument={}}return e.rootDocument}async function u(t){const a=e?.findServerInfo(t.sceneServerUrl);if(a?.owningSystemUrl)return a.owningSystemUrl;const o=t.sceneServerUrl.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";try{const e=(await r(o,{query:{f:\"json\"},responseType:\"json\",signal:t.signal})).data.owningSystemUrl;if(e)return e}catch(i){n(i)}return null}async function f(e,n){const o=a(e);if(!o)throw new t(\"invalid-feature-service-url\",\"Invalid feature service url\");const i=o.url.path,s=n.layerId;if(null==s)return{serverUrl:i};const l=c(n),u=n.featureServiceItem?await n.featureServiceItem.fetchData(\"json\"):null,f=(u?.layers?.[0]||u?.tables?.[0])?.customParameters,y=e=>{const t={query:{f:\"json\",...f},responseType:\"json\",authMode:e,signal:n.signal};return r(i,t)},m=y(\"anonymous\").catch((()=>y(\"no-prompt\"))),[p,d]=await Promise.all([m,l]),v=d?.layers,w=p.data&&p.data.layers;if(!Array.isArray(w))throw new Error(\"expected layers array\");if(Array.isArray(v))for(let r=0;r<Math.min(v.length,w.length);r++){if(v[r].id===s)return{serverUrl:i,layerId:w[r].id}}else if(null!=s&&s<w.length)return{serverUrl:i,layerId:w[s].id};throw new Error(\"could not find matching associated sublayer\")}async function y({sceneLayerItem:e,signal:r}){if(!e)return null;try{const t=(await e.fetchRelatedItems({relationshipType:\"Service2Service\",direction:\"reverse\"},{signal:r})).find((e=>\"Feature Service\"===e.type))||null;if(!t)return null;const n=new i({portal:t.portal,id:t.id});return await n.load(),n}catch(t){return n(t),null}}export{s as findAssociatedFeatureService};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}