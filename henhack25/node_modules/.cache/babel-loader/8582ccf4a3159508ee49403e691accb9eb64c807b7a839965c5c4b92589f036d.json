{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport { ArcadeDate as e } from \"../arcade/ArcadeDate.js\";\nimport t from \"../core/Error.js\";\nimport r from \"../core/Logger.js\";\nimport s from \"../geometry/SpatialReference.js\";\nconst i = () => r.getLogger(\"esri.support.arcadeOnDemand\"),\n  a = [\"geometry\", \"scale\", \"timeProperties\"];\nfunction n(e, t) {\n  if (null != t) for (const r of a) t.hasArcadeDependency(r) && e.add(r);\n  return e;\n}\nlet c;\nfunction o() {\n  return c || (c = (async () => {\n    const e = await import(\"./arcadeUtils.js\");\n    return {\n      arcade: e.arcade,\n      arcadeUtils: e,\n      Dictionary: e.Dictionary,\n      Feature: e.arcadeFeature,\n      Voxel: e.Voxel\n    };\n  })()), c;\n}\nconst l = (e, t, r) => d.create(e, t, r, null, [\"$feature\", \"$view\"], []),\n  p = (e, t, r) => d.create(e, t, r, null, [\"$feature\", \"$view\"], []),\n  u = (e, t, r, s) => d.create(e, t, r, s, [\"$feature\", \"$view\"], []);\nclass d {\n  constructor(e, t, r, s, i, a, n) {\n    this._dependencies = new Map(), this.services = null, this.script = e, this.evaluate = s;\n    const c = Array.isArray(a) ? a : a?.fields;\n    this.fields = c ?? [], this._syntaxTree = r, this._arcade = t, this._arcadeFeature = i, this._spatialReference = n, this._dependencies.set(\"geometry\", t.scriptTouchesGeometry(this._syntaxTree)), this._dependencies.set(\"scale\", this._arcade.referencesMember(this._syntaxTree, \"scale\")), this._dependencies.set(\"timeProperties\", this._arcade.scriptUsesViewProperties(this._syntaxTree, [\"timeProperties\"]));\n  }\n  static async create(r, a, n, c, l, p) {\n    const {\n        arcade: u,\n        Feature: m,\n        Dictionary: f\n      } = await o(),\n      h = a instanceof s ? a : s.fromJSON(a);\n    let w;\n    try {\n      w = u.parseScript(r, p);\n    } catch (j) {\n      return i().error(new t(\"arcade-bad-expression\", \"Failed to parse arcade script\", {\n        script: r,\n        error: j\n      })), null;\n    }\n    const y = l.reduce((e, t) => ({\n      ...e,\n      [t]: null\n    }), {});\n    let v = null;\n    null != c && (v = new f(c), v.immutable = !0, y.$config = null);\n    const $ = u.scriptUsesGeometryEngine(w),\n      _ = $ && u.enableGeometrySupport(),\n      g = u.scriptUsesFeatureSet(w) && u.enableFeatureSetSupport(),\n      F = u.scriptIsAsync(w),\n      S = F && u.enableAsyncSupport(),\n      b = {\n        vars: y,\n        spatialReference: h,\n        useAsync: !!S\n      };\n    await Promise.all([_, g, S]);\n    const A = new Set();\n    await u.loadDependentModules(A, w, null, F, $);\n    const D = new f();\n    D.immutable = !1, D.setField(\"scale\", 0);\n    const P = u.compileScript(w, b),\n      T = (t, r) => {\n        const s = t.$view?.timeZone;\n        if (\"$view\" in t && t.$view) {\n          let r;\n          if (D.setField(\"scale\", \"object\" == typeof t.$view && \"scale\" in t.$view ? t.$view.scale : void 0), \"object\" == typeof t.$view && \"timeProperties\" in t.$view && null != t.$view.timeProperties) {\n            const {\n              currentStart: i,\n              currentEnd: a\n            } = t.$view.timeProperties;\n            r = new f({\n              currentStart: null != i ? null != s ? e.epochToArcadeDate(i, s) : e.unknownEpochToArcadeDate(i) : void 0,\n              currentEnd: null != a ? null != s ? e.epochToArcadeDate(a, s) : e.unknownEpochToArcadeDate(a) : void 0,\n              startIncluded: !0,\n              endIncluded: !0\n            });\n          }\n          D.setField(\"timeProperties\", r), t.$view = D;\n        }\n        return v && (t.$config = v), P({\n          vars: t,\n          spatialReference: h,\n          services: r,\n          timeZone: s\n        });\n      };\n    return new d(r, u, w, T, new m(), n, h);\n  }\n  repurposeFeature(e) {\n    return e.geometry && !e.geometry.spatialReference && (e.geometry.spatialReference = this._spatialReference), this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry, e.attributes, {\n      fields: this.fields\n    }), this._arcadeFeature;\n  }\n  references(e) {\n    return this._dependencies.get(e) ?? !1;\n  }\n}\nexport { d as ArcadeExpression, n as collectExpressionDependencies, u as createDictionaryExpression, l as createLabelExpression, p as createRendererExpression, o as loadArcade };","map":{"version":3,"names":["ArcadeDate","e","t","r","s","i","getLogger","a","n","hasArcadeDependency","add","c","o","arcade","arcadeUtils","Dictionary","Feature","arcadeFeature","Voxel","l","d","create","p","u","constructor","_dependencies","Map","services","script","evaluate","Array","isArray","fields","_syntaxTree","_arcade","_arcadeFeature","_spatialReference","set","scriptTouchesGeometry","referencesMember","scriptUsesViewProperties","m","f","h","fromJSON","w","parseScript","j","error","y","reduce","v","immutable","$config","$","scriptUsesGeometryEngine","_","enableGeometrySupport","g","scriptUsesFeatureSet","enableFeatureSetSupport","F","scriptIsAsync","S","enableAsyncSupport","b","vars","spatialReference","useAsync","Promise","all","A","Set","loadDependentModules","D","setField","P","compileScript","T","$view","timeZone","scale","timeProperties","currentStart","currentEnd","epochToArcadeDate","unknownEpochToArcadeDate","startIncluded","endIncluded","repurposeFeature","geometry","repurposeFromGraphicLikeObject","attributes","references","get","ArcadeExpression","collectExpressionDependencies","createDictionaryExpression","createLabelExpression","createRendererExpression","loadArcade"],"sources":["C:/Users/nolan/tasks/HenHacks2025/henhack25/node_modules/@arcgis/core/support/arcadeOnDemand.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.32/esri/copyright.txt for details.\n*/\nimport{ArcadeDate as e}from\"../arcade/ArcadeDate.js\";import t from\"../core/Error.js\";import r from\"../core/Logger.js\";import s from\"../geometry/SpatialReference.js\";const i=()=>r.getLogger(\"esri.support.arcadeOnDemand\"),a=[\"geometry\",\"scale\",\"timeProperties\"];function n(e,t){if(null!=t)for(const r of a)t.hasArcadeDependency(r)&&e.add(r);return e}let c;function o(){return c||(c=(async()=>{const e=await import(\"./arcadeUtils.js\");return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature,Voxel:e.Voxel}})()),c}const l=(e,t,r)=>d.create(e,t,r,null,[\"$feature\",\"$view\"],[]),p=(e,t,r)=>d.create(e,t,r,null,[\"$feature\",\"$view\"],[]),u=(e,t,r,s)=>d.create(e,t,r,s,[\"$feature\",\"$view\"],[]);class d{constructor(e,t,r,s,i,a,n){this._dependencies=new Map,this.services=null,this.script=e,this.evaluate=s;const c=Array.isArray(a)?a:a?.fields;this.fields=c??[],this._syntaxTree=r,this._arcade=t,this._arcadeFeature=i,this._spatialReference=n,this._dependencies.set(\"geometry\",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set(\"scale\",this._arcade.referencesMember(this._syntaxTree,\"scale\")),this._dependencies.set(\"timeProperties\",this._arcade.scriptUsesViewProperties(this._syntaxTree,[\"timeProperties\"]))}static async create(r,a,n,c,l,p){const{arcade:u,Feature:m,Dictionary:f}=await o(),h=a instanceof s?a:s.fromJSON(a);let w;try{w=u.parseScript(r,p)}catch(j){return i().error(new t(\"arcade-bad-expression\",\"Failed to parse arcade script\",{script:r,error:j})),null}const y=l.reduce(((e,t)=>({...e,[t]:null})),{});let v=null;null!=c&&(v=new f(c),v.immutable=!0,y.$config=null);const $=u.scriptUsesGeometryEngine(w),_=$&&u.enableGeometrySupport(),g=u.scriptUsesFeatureSet(w)&&u.enableFeatureSetSupport(),F=u.scriptIsAsync(w),S=F&&u.enableAsyncSupport(),b={vars:y,spatialReference:h,useAsync:!!S};await Promise.all([_,g,S]);const A=new Set;await u.loadDependentModules(A,w,null,F,$);const D=new f;D.immutable=!1,D.setField(\"scale\",0);const P=u.compileScript(w,b),T=(t,r)=>{const s=t.$view?.timeZone;if(\"$view\"in t&&t.$view){let r;if(D.setField(\"scale\",\"object\"==typeof t.$view&&\"scale\"in t.$view?t.$view.scale:void 0),\"object\"==typeof t.$view&&\"timeProperties\"in t.$view&&null!=t.$view.timeProperties){const{currentStart:i,currentEnd:a}=t.$view.timeProperties;r=new f({currentStart:null!=i?null!=s?e.epochToArcadeDate(i,s):e.unknownEpochToArcadeDate(i):void 0,currentEnd:null!=a?null!=s?e.epochToArcadeDate(a,s):e.unknownEpochToArcadeDate(a):void 0,startIncluded:!0,endIncluded:!0})}D.setField(\"timeProperties\",r),t.$view=D}return v&&(t.$config=v),P({vars:t,spatialReference:h,services:r,timeZone:s})};return new d(r,u,w,T,new m,n,h)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}references(e){return this._dependencies.get(e)??!1}}export{d as ArcadeExpression,n as collectExpressionDependencies,u as createDictionaryExpression,l as createLabelExpression,p as createRendererExpression,o as loadArcade};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}