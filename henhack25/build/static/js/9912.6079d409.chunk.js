"use strict";(self.webpackChunkhenhack25=self.webpackChunkhenhack25||[]).push([[9912],{9912:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>K,createFieldInfoMap:()=>V,findRelatedLayer:()=>le,findUtilityNetwork:()=>ue,fixTokens:()=>U,formatAttributes:()=>W,formatEditInfo:()=>Q,formatValueToFieldInfo:()=>J,getAllFieldInfos:()=>P,getFieldInfo:()=>Y,getFieldInfoLabel:()=>x,getFixedFieldName:()=>A,getFixedFieldNames:()=>C,getHighlightKeyForFeature:()=>de,getSourceLayer:()=>N,graphicCallback:()=>L,htmlEntities:()=>_,isAssociatedFeatureSupportedLayer:()=>z,isExpressionField:()=>q,isFeatureSupportedLayer:()=>D,isGraphicForRelatableFeatureSupportedLayer:()=>H,isRelatableFeatureSupportedLayer:()=>O,isRelatableLayer:()=>S,isRelatedField:()=>te,preLayerQueryCallback:()=>oe,preRequestCallback:()=>ae,querySourceLayer:()=>X,queryUpdatedFeature:()=>ee,shouldOpenInNewTab:()=>v,substituteAttributes:()=>j,substituteFieldsInLinksAndAttributes:()=>R});var r=n(81806),i=n(76460),o=n(88685),a=n(65256),l=n(50265),u=n(53430),s=n(31933),f=n(42633),d=n(98976),c=n(67478);const y=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),p=/href=(""|'')/gi,m=/(\{([^{\r\n]+)\})/g,g=/'/g,h=/^\s*expression\//i,b=/(\n)/gi,I=/[\u00A0-\u9999<>&]/gim,F=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,w=/^(?:mailto:|tel:)/,T="relationships/",Z=(0,a.J2)("short-date-short-time");function N(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function L(e){let{type:t,value:n,event:r}=e;try{return"function"==typeof n?n(r):await n}catch(i){return void y().error("error",`An error occurred when calling the "${t}" function`,{error:i,graphic:r.graphic,value:n})}}function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!w.test(e.trim().toLowerCase())}function q(e){return!!e&&h.test(e)}function x(e,t){const n=function(e,t){if(!t||!q(t)||!e)return;const n=t.replace(h,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,e?.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function A(e,t){const n=k(t,e);return n?n.name:e}function C(e,t){return e&&e.map((e=>A(e,t)))}function k(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function E(e){return`${e}`.trim()}function R(e){let{attributes:t,globalAttributes:n,layer:r,text:i,expressionAttributes:o,fieldInfoMap:a}=e;return i?j({formattedAttributes:n,template:$(i,{...n,...o,...t},r),fieldInfoMap:a}):""}function j(e){let{formattedAttributes:t,template:n,fieldInfoMap:r}=e;return E(function(e){return e.replaceAll(p,"")}((0,o.HC)((0,o.HC)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,r))),t)))}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t[e];if("string"==typeof r){const i="%27",o=(n?encodeURIComponent(r):r).replaceAll(g,i);t[e]=o}}(e,n,t))),n}function U(e,t){return e.replaceAll(m,((e,n,r)=>{const i=k(t,r);return i?`{${i.name}}`:n}))}function $(e,t,n){const r=U(e,n);return r?r.replaceAll(F,((e,n,r)=>function(e,t,n){const r=(t=E(t))&&"{"!==t[0];return(0,o.HC)(e,M(n,r||!1))}(e,n||r,t))):r}function D(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function S(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function O(e){return D(e)&&S(e)}function z(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function H(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&O(e.sourceLayer)}function J(e,t){const{fieldInfos:n,fieldName:r,preventPlacesFormatting:i,layer:o,timeZone:a}=t,s=Y(n,r),d=k(o,r);if(s&&!(0,u.JL)(r)){const t=d?.type,n=s.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,f.i0)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:a,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}})}const c=s?.format;return"string"==typeof e&&(0,u.JL)(r)&&c?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?G(e,",",", ",t):e.includes(";")?G(e,";","; ",t):e.includes(" ")?G(e," "," ",t):(0,l.ZV)(Number(e),(0,l.yx)(t))}(e,c):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,c))||null==e||null==c?K(e):(0,l.ZV)(e,i?{...(0,l.yx)(c),minimumFractionDigits:0,maximumFractionDigits:20}:(0,l.yx)(c))}function G(e,t,n,r){return e.trim().split(t).map((e=>(0,l.ZV)(Number(e),(0,l.yx)(r)))).join(n)}function Y(e,t){if(e?.length&&t)return e.find((e=>e.fieldName?.toLowerCase()===t.toLowerCase()))}function Q(e,t,n,r){const{creatorField:i,creationDateField:o,editorField:l,editDateField:u}=e;if(!t)return;const s=(0,c.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,n,Z,"date"),f={...Z,...s},d=t[u];if("number"==typeof d){const e=t[l];return{type:"edit",date:(0,a.Yq)(d,f),user:e}}const y=t[o];if("number"==typeof y){const e=t[i];return{type:"create",date:(0,a.Yq)(y,f),user:e}}return null}function V(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=A(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function P(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}})),t):t}function _(e){return e.replaceAll(I,(e=>`&#${e.charCodeAt(0)};`))}function K(e){return"string"==typeof e?e.replaceAll(b,'<br class="esri-text-new-line" />'):e}function B(e){const{value:t,fieldName:n,fieldInfos:i,fieldInfoMap:o,layer:a,graphic:l,timeZone:s}=e;if(null==t)return"";const d=function(e){let{fieldName:t,value:n,graphic:i,layer:o}=e;if(te(t))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const a=i&&o.getFieldDomain(t,{feature:i,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:n,value:t,graphic:l,layer:a});if(d)return d;const c=function(e){let{fieldName:t,graphic:n,layer:r}=e;if(te(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||t!==i)return null;const o=r.getFeatureType(n);return o?o.name:null}({fieldName:n,graphic:l,layer:a});if(c)return c;if(o.get(n.toLowerCase()))return J(t,{fieldInfos:i||Array.from(o.values()),fieldName:n,layer:a,timeZone:s});const y=a?.fieldsIndex?.get(n);return y&&((0,f.fs)(y)||(0,u.OH)(y))?(0,f.i0)(t,{fieldType:y.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}}):K(t)}function W(e){let{fieldInfos:t,attributes:n,layer:r,graphic:i,fieldInfoMap:o,relatedInfos:a,timeZone:l}=e;const u={};return a?.forEach((e=>function(e){let{attributes:t,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}=e;t&&n&&(n.relatedFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}))),n.relatedStatsFeatures?.forEach((e=>ne({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:a}))))}({attributes:u,relatedInfo:e,fieldInfoMap:o,fieldInfos:t,layer:r,timeZone:l}))),n&&Object.keys(n).forEach((e=>{const a=n[e];u[e]=B({fieldName:e,fieldInfos:t,fieldInfoMap:o,layer:r,value:a,graphic:i,timeZone:l})})),u}async function X(e,t){const{layer:n,graphic:r,outFields:i,objectIds:o,returnGeometry:a,spatialReference:l}=e,u=o[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:u,requiredFields:i};return y().warn(e,t),null}if(!(0,s.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:a};return y().warn(e,t),null}const f=n.createQuery();return f.objectIds=o,f.outFields=i?.length?i:[n.objectIdField],f.returnGeometry=!!a,f.returnZ=!!a,f.returnM=!!a,f.outSpatialReference=l,(await n.queryFeatures(f,t)).features[0]}async function ee(e,t){let{graphic:n,popupTemplate:r,layer:i,spatialReference:o}=e;if(!i||!r)return;if("function"==typeof i.load&&await i.load(t),!n.attributes)return;const a=i.objectIdField,l=n.attributes[a];if(null==l)return;const s=[l],f=await r.getRequiredFields(i.fieldsIndex),c=(0,u.Kl)(f,n),y=c?[]:f.includes(a)?f:[...f,a],p=r.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,d.lw)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(r);if(c&&!p)return;const m=await X({layer:i,graphic:n,outFields:y,objectIds:s,returnGeometry:p,spatialReference:o},t);m&&(m.geometry&&(n.geometry=m.geometry),m.attributes&&(n.attributes={...n.attributes,...m.attributes}))}function te(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(T)}function ne(e){let{attributes:t,graphic:n,relatedInfo:r,fieldInfos:i,fieldInfoMap:o,layer:a,timeZone:l}=e;t&&n&&r&&Object.keys(n.attributes).forEach((e=>{const u=function(e){return`${T}${e.layerId}/${e.fieldName}`}({layerId:r.relation.id.toString(),fieldName:e}),s=n.attributes[e];t[u]=B({fieldName:u,fieldInfos:i,fieldInfoMap:o,layer:a,value:s,graphic:n,timeZone:l})}))}const re=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ie=e=>{let{layer:t,method:n,query:r,definitionExpression:i}=e;if(!t.capabilities?.query?.supportsCacheHint||"attachments"===n)return;const o=null!=r.where?r.where:null,a=null!=r.geometry?r.geometry:null;re(i)||re(o)||"extent"===a?.type||"tile"===r.resultType||(r.cacheHint=!0)},oe=e=>{let{query:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})},ae=e=>{let{queryPayload:t,layer:n,method:r}=e;ie({layer:n,method:r,query:t,definitionExpression:`${n.definitionExpression} ${n.serviceDefinitionExpression??""}`})};function le(e,t,n){return e&&t&&n?"sublayer"===t.type?fe({layers:t.layer?.sublayers,map:e,relatedLayer:t,relationship:n})||fe({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):fe({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||fe({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ue(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find((e=>e.isUtilityLayer(t))):null}function se(e,t){return e?.allTables.find((e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url))}function fe(e){let{map:t,relationship:n,relationship:{relatedTableId:r},relatedLayer:i,layers:o}=e;if(!o)return null;for(const a of o){if("map-image"===a.type){const e=fe({layers:a.sublayers,map:t,relatedLayer:i,relationship:n})||fe({layers:a.subtables,map:t,relatedLayer:i,relationship:n});if(e)return e;continue}if(!O(a))continue;if("sublayer"===i.type){if(a!==i&&a.id===r)return a.isTable?se(t,a):a;continue}const e="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!e)return null;if("sublayer"!==a.type){if(a!==i&&a.url===e&&a.layerId===r)return a}else if(a!==i&&a.layer?.url===e&&a.id===r)return a.isTable?se(t,a):a}return null}function de(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}},42633:(e,t,n)=>{n.d(t,{fs:()=>a,i0:()=>l});var r=n(65256),i=n(53430),o=(n(98976),n(86300),n(67478));new Set(["integer","small-integer"]);function a(e){return(0,i.vE)(e)||(0,i.zD)(e)||(0,i.Ah)(e)}function l(e,t){const{format:n,timeZoneOptions:i,fieldType:a}=t??{};let l,u;if(i&&({timeZone:l,timeZoneName:u}=(0,o.hv)(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,(0,r.J2)(n||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const t=(0,r.J2)(n||"short-date");return"string"==typeof e?(0,r.iS)(e,{...t}):(0,r.Yq)(e,{...t,timeZone:o.n$})}case"time-only":{const t=(0,r.J2)(n||"short-time");return"string"==typeof e?(0,r.F8)(e,t):(0,r.Yq)(e,{...t,timeZone:o.n$})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const t=n||i?(0,r.J2)(n||"short-date-short-time"):void 0,o=t?{...t,timeZone:l,timeZoneName:u}:void 0;return"string"==typeof e?(0,r.Ey)(e,o):(0,r.Yq)(e,o)}default:{const t=n||i?(0,r.J2)(n||"short-date-short-time"):void 0;return(0,r.Yq)("string"==typeof e?new Date(e):e,t?{...t,timeZone:l,timeZoneName:u}:void 0)}}}}}]);
//# sourceMappingURL=9912.6079d409.chunk.js.map